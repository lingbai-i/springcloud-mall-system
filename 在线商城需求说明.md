# 基于 Spring Cloud 的微服务在线商城 — 功能与模块需求

源图：d:\code\毕业设计\毕业设计\系统功能架构初步设计图.png

## 1. 项目概述
- 项目名称：基于 Spring Cloud 的微服务在线商城
- 架构特性：服务注册发现、配置中心、网关、链路追踪、限流熔断、统一日志与监控。
- 用户类型：游客、注册用户、商家用户、管理员/运营与内容、客服。

## 2. 总体功能范围
- 前台：注册登录、用户资料与地址、商品浏览与搜索、购物车、下单、订单查询、支付与退款、评价与售后。
- 中台/运营与内容：商品与分类、内容管理、系统监控。
- 后台管理：权限角色与账号、库存管理与监控。
- 商家侧（新增）：入驻与审核、店铺管理、商家商品与库存、商家订单与售后、结算账务、商家成员与权限、营销工具。

## 2.1 角色功能优化与权限边界
- 游客（未登录）
  - 能力：浏览商品与分类、搜索与筛选、查看评价与内容、注册/登录、加入本地购物车、分享链接。
  - 边界：不可下单/支付/评价/售后；无个性化数据写入。
- 注册用户（买家）
  - 能力：购物车全功能、下单与支付、订单查询与取消、地址与资料维护、评价与追评、申请售后与退款、消息通知订阅。
  - 边界：仅操作本人订单与数据；敏感操作（退款、地址删除）需二次确认与风控校验。
- 商家用户（店铺侧）
  - 能力：店铺信息配置、商品/SPU/SKU 发布与上下架、库存维护（入/出/盘点）、订单发货与批量处理、售后协同与逆向物流、活动与优惠券、数据看板；成员管理与岗位权限；结算与提现申请。
  - 边界：仅可访问所属店铺数据；平台级配置/费率/类目结构不可变更；敏感动作（资质变更、价格大幅调整、批量上/下架）触发审核与审计。
- 平台管理员（系统/风控）
  - 能力：用户与角色管理、服务治理与监控、限流熔断与开关、商家入驻审核与违规处置、费率与结算规则配置、全局日志与审计、数据权限与脱敏策略。
  - 边界：变更需走审批或变更单；关键操作记录审计（含原因与工单）。
- 运营与内容（交易/类目/CMS 合并）
  - 能力：类目与属性维护、商品审核（敏感类目/内容）、活动配置与排期、价格策略校验、首页与频道位编排、搜索与推荐策略协作、内容素材与页面装修、Banner/专题/公告维护、内容排期与上/下线、灰度与预发布验证、运营报表。
  - 边界：不直接改动商家订单与结算；对外展示内容发布必须有审批与定时机制；不得触达交易明细数据（除聚合报表）。
- 客服（服务台）
  - 能力：订单与物流查询、售后受理与升级、工单管理、与商家协同处理；可触发补偿（如优惠券）但需授权。
  - 边界：不可直接改动结算与费率；大额退款或改价需走审批链。

- 通用权限原则
  - 最小权限：角色仅授予完成职责所必需资源（接口/页面/数据域）。
  - 数据隔离：按用户/店铺/组织维度强制隔离；跨域访问需显式授权与审计。
  - 审批与审计：关键动作（上/下架、价格变更、退款、结算打款、开关变更）必须走审批；所有变更写入审计日志（操作者、时间、来源、原因）。
  - 风控策略：登录异常、频繁操作、金额异常触发二次校验或人工复核。

- 关键流程职责（RACI 摘要）
  - 商品发布：商家R；运营与内容A（敏感类目审核与展示位编排）；客服I；管理员C（策略/异常）。
  - 订单发货：商家R；客服I；运营与内容I；管理员C（风控）。
  - 售后退款：客服R；商家C；运营与内容C；管理员A（大额/异常）。
  - 活动上线：运营与内容R；商家C（参与）；管理员A（开关与限流）。
  - 结算打款：管理员A；财务R（如有）；商家I；运营与内容C（规则校验）。

## 3. 模块与子模块需求
### 3.1 用户中心模块
- 注册登录验证：手机号/邮箱/用户名；验证码与防刷；找回/重置密码；JWT 登录态与刷新。
- 用户信息管理：昵称、头像、联系方式；地址增删改查；安全设置与登录设备记录。

### 3.2 商品服务模块
- 商品分类管理：多级分类，启停与排序，商品绑定。
- 商品信息管理：SPU/SKU、价格、上下架、媒体资源、属性标签。
- 商品搜索服务：关键词、筛选与排序、联想与推荐（可扩展）、分页与缓存。
- 评价管理系统：评价发布/审核/展示；与订单完成状态校验。

### 3.3 订单服务模块
- 购物车管理：增减删清、SKU 合并与限购、结算勾选、跨设备同步。
- 订单处理：下单校验（库存/价格/优惠/地址/运费）、状态流转、取消关闭、物流跟踪。
- 售后服务：退换仅退款、申请与审核、凭证上传、与退款联动、进度通知。

### 3.4 支付服务模块
- 支付集成：多渠道聚合、支付单生成与签名、回调处理。
- 支付处理：二维码/跳转、成功失败取消回调、幂等与对账、风控校验。
- 退款管理：申请/审核/执行、渠道回调与同步、异常重试与对账。

### 3.5 库存服务模块
- 库存监控：阈值预警、缺货告警、报表（按 SKU/仓）。
- 库存操作：占用/释放/扣减、入出库与盘点、事务与补偿防超卖。

### 3.6 后台管理模块
- 系统监控：健康检查、性能指标、调用链日志、异常告警、限流熔断配置。
- 内容管理：Banner/专题/公告/活动位，发布上下线与定时；素材库与富文本。
- 权限管理：RBAC 用户/角色/权限；菜单与资源授权；审计日志。

### 3.7 商家用户模块（新增）
- 商家入驻与审核：
  - 入驻申请：主体类型（企业/个体）、联系人、资质与证照上传、银行账户信息。
  - 审核流程：初审（资料完备性）、复审（合规性），支持驳回与再次提交；审核结果通知。
  - 合同与规则：线上签约、服务协议与费率确认、保证金（可选）。
- 店铺管理：
  - 店铺信息：名称、LOGO、简介、经营类目、展示模板与装修（可扩展）。
  - 店铺状态：开业/停业/冻结；违规处理与处罚记录。
- 商家商品与库存：
  - 商品发布：SPU/SKU 维护、价格、主图与详情、上下架；敏感类目需平台复核。
  - 库存维护：入库/出库/盘点；与平台库存服务联动，支持多仓（可扩展）。
- 商家订单与售后：
  - 订单列表：筛选（状态/时间/渠道）、发货处理、批量操作、售后协同。
  - 发货与物流：面单打印、发货单、物流跟踪回传；逾期发货预警。
  - 售后处理：商家侧审核与协商、逆向物流、换货补发。
  - 订单履约优化（新增）：合单/拆单、包裹路由、拣货波次与电子面单、批量打单与波次发货、妥投与签收异常处理。
  - 售后自动化（新增）：依据规则自动判责/自动同意或升级；黑白名单与风险评分；跨仓逆向路径优化。
- 结算与账务：
  - 结算周期与费率：按日/周/月结；平台佣金、支付手续费、活动分摊。
  - 对账与结算单：订单与退款对账、结算单生成与确认；提现申请与打款。
  - 税务与发票（可扩展）。
  - 分账与多账户（新增）：支持按店铺/品牌/活动维度分账；子账户余额与提现规则；结算争议提报与复核流程。
- 商家成员与权限：
  - 店铺成员：创建/邀请/禁用；岗位角色（店长/运营/客服/仓管/财务）。
  - 资源授权：页面与接口粒度的权限；操作审计与风控。
  - 权限模板与审批流（新增）：可复用的角色模板；敏感动作（资质变更、批量上/下架、价格大幅调整）需审批；审计留痕与回滚策略。
- 商家营销工具：
  - 活动：满减、满赠、限时折扣、优惠券；参与与排期管理。
  - 店铺内容：自定义 Banner/专题、橱窗位；数据看板（浏览/转化）。
  - 高级促销（新增）：权益中心、优惠券批次与核销码、阶梯价与组合/加价购、黑白名单与风控预检、活动冲突检测与模拟生效。
- 商家数据与风控（新增）：
  - 经营数据看板：GMV、订单量、客单价、退款率、转化率、活动效果等；多维筛选与导出；阈值预警。
  - 风控与合规：高风险操作拦截与审批；违规内容识别与处置（配合平台）；合规提示与留痕。

## 4. 关键业务流程（补充商家）
- 商家入驻：提交资料 → 初审/复审 → 合同签署 → 开店成功 → 店铺配置与首批商品发布。
- 商品发布：编辑 SPU/SKU → 资质或敏感类目复核（如需） → 上架 → 与库存服务同步。
- 商家发货：新订单 → 打单与打包 → 发货与物流回传 → 超时预警与客服协同。
- 商家结算：周期结算 → 佣金与费用计算 → 结算单确认 → 提现与打款 → 异常核对与重算。

## 5. 示例接口（摘要，最终以详细设计为准）
- 商家入驻
  - POST /merchant/onboard/apply 提交入驻申请
  - GET  /merchant/onboard/status 查询审核状态
- 店铺与成员
  - GET  /merchant/store/profile 店铺信息；PUT 更新
  - POST /merchant/staff 成员新增；PUT/DELETE 成员维护
  - GET  /merchant/permissions/templates 权限模板列表；POST /merchant/permissions/approve 发起敏感操作审批
- 商家商品
  - POST /merchant/products 新建 SPU；PUT 更新；POST /merchant/skus 维护 SKU
  - PUT  /merchant/products/{id}/publish 上架；PUT /merchant/products/{id}/unpublish 下架
- 商家订单与售后
  - GET  /merchant/orders 列表；PUT /merchant/orders/{id}/ship 发货
  - POST /merchant/orders/batch-ship 批量发货；POST /merchant/shipping/waybills 电子面单申请
  - GET  /merchant/aftersales 售后列表；PUT /merchant/aftersales/{id} 处理
- 结算账务
  - GET  /merchant/settlements 结算单列表；POST /merchant/withdraw 提现申请
  - POST /merchant/settlements/dispute 结算争议提报；GET /merchant/settlements/{id}/audit 审核详情
- 营销工具
  - POST /merchant/coupons/batches 创建优惠券批次；POST /merchant/coupons/verify 核销

## 6. 数据实体（新增与扩展）
- 商家 Merchant：id、主体类型、公司名称、统一社会信用代码、联系人、电话、邮箱、银行账户、状态、入驻与审核时间。
- 店铺 Store：id、merchantId、名称、logo、简介、类目范围、状态、开店/停业时间、违规记录。
- 店铺成员 Staff：id、storeId、账号、角色、状态、最近登录、审计信息。
- 结算单 Settlement：id、storeId、周期、订单金额、退款金额、佣金费率与金额、手续费、应结/已结、结算时间。
- 提现单 Withdrawal：id、storeId、结算单Ids、金额、打款渠道、状态、完成时间。
- 合同与资质 Contract/Qualification：id、merchantId、类型、文件地址、生效/失效时间、审核状态。

## 7. 验收标准（商家侧）
- 入驻与审核：资料校验完整、流程闭环、通知准确；驳回后可再次提交。
- 店铺与成员：信息变更即时生效；权限精确控制；操作审计可追溯。
- 商品与库存：上/下架一致性；与平台库存联动无超卖；多仓（如启用）数据一致。
- 订单与售后：发货及时率达标；物流回传正确；售后处理与退款闭环。
- 结算账务：结算对账准确；佣金费用计算正确；提现流程合规与可追踪。
- 营销工具：活动规则生效与冲突检测；店铺数据看板指标准确。

## 8. 里程碑（含商家）
- M1：用户与商品前台、商家入驻与店铺创建（基础）。
- M2：购物车与下单、商家商品发布与库存联动。
- M3：支付与订单全链路、商家发货与售后协同。
- M4：结算账务闭环、提现与对账。
- M5：内容管理、系统监控与审计；商家营销工具初版。
- M6：性能与稳定性专项、灰度与压测。

—— 完 ——