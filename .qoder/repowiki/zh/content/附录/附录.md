# 附录

<cite>
**本文档引用文件**  
- [data字典.md](file://数据字典.md)
- [QUICK_REFERENCE.md](file://QUICK_REFERENCE.md)
- [SERVICE_COMPLETION_SUMMARY.md](file://SERVICE_COMPLETION_SUMMARY.md)
- [CHANGELOG_SERVICE_AUTO_DETECTION.md](file://CHANGELOG_SERVICE_AUTO_DETECTION.md)
- [backend/admin-service/src/main/resources/sql/schema.sql](file://backend/admin-service/src/main/resources/sql/schema.sql)
- [backend/user-service/src/main/resources/application.yml](file://backend/user-service/src/main/resources/application.yml)
- [backend/product-service/src/main/resources/application.yml](file://backend/product-service/src/main/resources/application.yml)
- [backend/order-service/src/main/resources/application.yml](file://backend/order-service/src/main/resources/application.yml)
- [backend/payment-service/src/main/resources/application.yml](file://backend/payment-service/src/main/resources/application.yml)
- [backend/merchant-service/src/main/resources/application.yml](file://backend/merchant-service/src/main/resources/application.yml)
- [backend/cart-service/src/main/resources/application.yml](file://backend/cart-service/src/main/resources/application.yml)
- [backend/sms-service/src/main/resources/application.yml](file://backend/sms-service/src/main/resources/application.yml)
</cite>

## 目录
1. [数据字典](#数据字典)  
2. [配置参数速查表](#配置参数速查表)  
3. [项目变更日志](#项目变更日志)  
4. [服务完成状态汇总](#服务完成状态汇总)

## 数据字典

本节提供系统核心数据库表结构的详细说明，便于开发者理解数据模型和字段含义。

### 管理服务数据库表结构

#### 管理员表 (`admin`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| username | VARCHAR(50) | 否 | 无 | 登录账号 |
| password | VARCHAR(255) | 否 | 无 | BCrypt加密密码 |
| real_name | VARCHAR(50) | 否 | 无 | 真实姓名 |
| email | VARCHAR(100) | 是 | NULL | 邮箱 |
| phone | VARCHAR(20) | 是 | NULL | 手机号 |
| avatar | VARCHAR(500) | 是 | NULL | 头像URL |
| status | TINYINT | 否 | 1 | 状态: 1-正常 0-禁用 |
| last_login_time | DATETIME | 是 | NULL | 最后登录时间 |
| last_login_ip | VARCHAR(50) | 是 | NULL | 最后登录IP |
| failed_login_count | INT | 是 | 0 | 登录失败次数 |
| locked_until | DATETIME | 是 | NULL | 锁定截止时间 |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | 否 | CURRENT_TIMESTAMP | 更新时间 |

#### 角色表 (`role`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| role_code | VARCHAR(50) | 否 | 无 | 角色编码 |
| role_name | VARCHAR(50) | 否 | 无 | 角色名称 |
| description | VARCHAR(200) | 是 | NULL | 角色描述 |
| status | TINYINT | 否 | 1 | 状态: 1-正常 0-禁用 |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | 否 | CURRENT_TIMESTAMP | 更新时间 |

#### 权限表 (`permission`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| permission_code | VARCHAR(100) | 否 | 无 | 权限编码 |
| permission_name | VARCHAR(50) | 否 | 无 | 权限名称 |
| resource_type | VARCHAR(20) | 否 | 无 | 资源类型 |
| resource | VARCHAR(100) | 否 | 无 | 资源标识 |
| action | VARCHAR(20) | 否 | 无 | 操作类型 |
| description | VARCHAR(200) | 是 | NULL | 权限描述 |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 |

#### 角色权限关联表 (`role_permission`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| role_id | BIGINT | 否 | 无 | 角色ID |
| permission_id | BIGINT | 否 | 无 | 权限ID |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 |

#### 管理员角色关联表 (`admin_role`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| admin_id | BIGINT | 否 | 无 | 管理员ID |
| role_id | BIGINT | 否 | 无 | 角色ID |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 创建时间 |

#### 操作审计日志表 (`audit_log`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| admin_id | BIGINT | 否 | 无 | 操作人ID |
| admin_username | VARCHAR(50) | 否 | 无 | 操作人账号 |
| operation_type | VARCHAR(50) | 否 | 无 | 操作类型 |
| resource_type | VARCHAR(50) | 否 | 无 | 资源类型 |
| resource_id | VARCHAR(100) | 是 | NULL | 资源ID |
| operation_desc | VARCHAR(500) | 否 | 无 | 操作描述 |
| request_method | VARCHAR(10) | 是 | NULL | 请求方法 |
| request_url | VARCHAR(500) | 是 | NULL | 请求URL |
| request_params | TEXT | 是 | NULL | 请求参数(JSON) |
| response_result | TEXT | 是 | NULL | 响应结果(JSON) |
| ip_address | VARCHAR(50) | 是 | NULL | 操作IP |
| user_agent | VARCHAR(500) | 是 | NULL | 浏览器标识 |
| status | TINYINT | 否 | 无 | 状态: 1-成功 0-失败 |
| error_msg | TEXT | 是 | NULL | 错误信息 |
| execution_time | INT | 是 | NULL | 执行时间(ms) |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 操作时间 |

#### 登录日志表 (`login_log`)
| 字段名 | 类型 | 允许空 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| id | BIGINT | 否 | 自增 | 主键 |
| admin_id | BIGINT | 是 | NULL | 管理员ID(失败时为空) |
| username | VARCHAR(50) | 否 | 无 | 登录账号 |
| login_result | TINYINT | 否 | 无 | 结果: 1-成功 0-失败 |
| failure_reason | VARCHAR(200) | 是 | NULL | 失败原因 |
| ip_address | VARCHAR(50) | 是 | NULL | 登录IP |
| user_agent | VARCHAR(500) | 是 | NULL | 浏览器标识 |
| created_at | DATETIME | 否 | CURRENT_TIMESTAMP | 登录时间 |

**Section sources**
- [backend/admin-service/src/main/resources/sql/schema.sql](file://backend/admin-service/src/main/resources/sql/schema.sql)

## 配置参数速查表

本节汇总各核心微服务的关键配置参数，便于快速查阅和调整。

### 用户服务 (`user-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8082 | 服务监听端口 |
| 服务名称 | spring.application.name | user-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_user | MySQL连接地址 |
| JWT密钥 | jwt.secret | mallSecretKeyForJWTToken... | JWT令牌生成密钥 |
| JWT有效期 | jwt.expiration | 604800000 | 7天（毫秒） |
| JWT签发者 | jwt.issuer | mall-system | 令牌签发者标识 |
| JWT启用状态 | security.jwt.enabled | false | 开发模式禁用认证 |

**Section sources**
- [backend/user-service/src/main/resources/application.yml](file://backend/user-service/src/main/resources/application.yml)

### 商品服务 (`product-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8083 | 服务监听端口 |
| 服务名称 | spring.application.name | product-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_product | MySQL连接地址 |
| Hikari连接池 | spring.datasource.hikari.maximum-pool-size | 20 | 最大连接数 |
| Nacos地址 | spring.cloud.nacos.discovery.server-addr | localhost:8848 | 服务注册中心地址 |
| 命名空间 | spring.cloud.nacos.discovery.namespace | simple | Nacos命名空间 |

**Section sources**
- [backend/product-service/src/main/resources/application.yml](file://backend/product-service/src/main/resources/application.yml)

### 订单服务 (`order-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8084 | 服务监听端口 |
| 服务名称 | spring.application.name | order-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_order | MySQL连接地址 |
| Redis数据库 | spring.redis.database | 2 | Redis数据库索引 |
| RabbitMQ主机 | spring.rabbitmq.host | localhost | 消息队列地址 |
| 订单超时时间 | order.timeout-minutes | 30 | 未支付订单自动取消时间（分钟） |
| 自动确认天数 | order.auto-confirm-days | 7 | 发货后自动确认收货天数 |
| 分布式锁超时 | order.lock-timeout-seconds | 30 | 分布式锁持有时间（秒） |

**Section sources**
- [backend/order-service/src/main/resources/application.yml](file://backend/order-service/src/main/resources/application.yml)

### 支付服务 (`payment-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8085 | 服务监听端口 |
| 上下文路径 | server.servlet.context-path | /payment | 服务访问路径 |
| 服务名称 | spring.application.name | payment-service | Nacos注册名称 |
| 支付宝AppID | payment.alipay.app-id | 2021000000000000 | 支付宝开放平台应用ID |
| 支付宝网关 | payment.alipay.gateway-url | https://openapi.alipaydev.com/gateway.do | 支付宝沙箱网关 |
| 微信AppID | payment.wechat.app-id | wx1234567890abcdef | 微信公众号AppID |
| 微信商户号 | payment.wechat.mch-id | 1234567890 | 微信支付商户号 |
| 回调地址 | payment.wechat.notify-url | http://localhost:8084/payment/api/payment/callback/wechat | 支付回调地址 |

**Section sources**
- [backend/payment-service/src/main/resources/application.yml](file://backend/payment-service/src/main/resources/application.yml)

### 商家服务 (`merchant-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8087 | 服务监听端口 |
| 服务名称 | spring.application.name | merchant-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_merchant | MySQL连接地址 |
| 自动审核 | merchant.audit.auto-approve | false | 是否开启商家入驻自动审核 |
| 审核过期天数 | merchant.audit.expire-days | 30 | 商家审核申请过期天数 |
| 佣金比例 | merchant.commission.rate | 0.05 | 平台对商家的抽成比例（5%） |
| MinIO端点 | minio.endpoint | http://localhost:9000 | 文件存储服务地址 |

**Section sources**
- [backend/merchant-service/src/main/resources/application.yml](file://backend/merchant-service/src/main/resources/application.yml)

### 购物车服务 (`cart-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8088 | 服务监听端口 |
| 服务名称 | spring.application.name | cart-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_cart | MySQL连接地址 |
| Redis数据库 | spring.data.redis.database | 1 | Redis数据库索引 |
| JWT启用状态 | security.jwt.enabled | false | 开发模式禁用JWT认证 |

**Section sources**
- [backend/cart-service/src/main/resources/application.yml](file://backend/cart-service/src/main/resources/application.yml)

### 短信服务 (`sms-service`)
| 配置项 | 路径 | 示例值 | 说明 |
|--------|------|--------|------|
| 服务端口 | server.port | 8089 | 服务监听端口 |
| 服务名称 | spring.application.name | sms-service | Nacos注册名称 |
| 数据库URL | spring.datasource.url | jdbc:mysql://localhost:3307/mall_sms | MySQL连接地址 |
| 验证码长度 | sms.code.length | 6 | 生成的验证码位数 |
| 验证码有效期 | sms.code.expireTime | 180 | 验证码有效时间（秒） |
| 发送间隔限制 | sms.rateLimit.interval | 60 | 同一手机号发送间隔（秒） |
| 全局请求限制 | sms.rateLimit.global.maxRequests | 1000 | 全局每分钟最大请求数 |
| 推送服务URL | sms.push.url | https://push.spug.cc/send/ApaWxrR1yyj7YLGB | 第三方消息推送地址 |

**Section sources**
- [backend/sms-service/src/main/resources/application.yml](file://backend/sms-service/src/main/resources/application.yml)

## 项目变更日志

本节记录系统核心功能的重大更新历史。

### 版本 2.0 (2025-11-11)

#### 重大更新
本次更新为在线商城系统引入了**智能化服务自动检测与管理**功能，大幅提升开发和运维效率。

#### 新增功能
1. **智能启动脚本 (`start-dev-silent.bat`)**
   - 自动服务发现：智能扫描 `backend` 目录，自动识别所有可启动的微服务
   - 排除过滤机制：自动排除非服务模块（common-bom、common-core、simple-test）
   - 依赖关系管理：按照预定义的优先级顺序启动服务
   - 后台静默运行：所有服务在后台运行，无CMD窗口弹出
   - 实时状态反馈：显示启动进度和服务统计信息
   - 完整日志记录：所有服务日志统一保存到 `logs/` 目录

2. **增强服务状态检查 (`check-services-silent.ps1`)**
   - 自动服务扫描：动态检测所有可用的微服务
   - 端口自动识别：从配置文件读取服务端口
   - 实时状态监控：检测服务运行状态和健康度
   - 日志大小统计：显示各服务日志文件大小
   - 美观输出格式：彩色输出，状态一目了然

3. **服务管理工具 (`service-manager.ps1`)**
   - 交互式菜单：用户友好的命令行界面
   - 服务列表查看：显示所有服务及其状态
   - 单服务操作：启动、停止、重启指定服务
   - 日志查看：快速查看服务日志（最近50行）
   - 批量操作：一键启动/停止所有服务
   - 命令行模式：支持直接命令行调用

4. **完整技术文档**
   - 新增《自动服务检测指南》
   - 新增《更新日志》
   - 更新《README.md》和《QUICK_START.md》

#### 功能对比
| 功能项 | v1.0 | v2.0 |
|--------|------|------|
| 服务数量 | 固定4个 | 自动检测所有 |
| 新增服务 | 需修改脚本 | 自动识别 |
| 启动方式 | 手动逐个 | 智能有序启动 |
| 状态检查 | 固定列表 | 动态扫描 |
| 日志管理 | 分散 | 统一管理 |
| 服务管理 | 无 | 完整工具 |
| 扩展性 | 低 | 高 |

#### 性能优化
- **启动时间对比**：
  - v1.0：手动逐个启动，约5分钟
  - v2.0：自动批量启动，约90秒
  - **提升**：约3倍

**Section sources**
- [CHANGELOG_SERVICE_AUTO_DETECTION.md](file://CHANGELOG_SERVICE_AUTO_DETECTION.md)

## 服务完成状态汇总

本节提供系统所有服务的完整状态清单。

### 系统概览
| 类型 | 数量 | 说明 |
|------|------|------|
| **微服务** | **10个** | 所有业务服务 |
| **基础设施** | 3个 | MySQL、Redis、Nacos |
| **前端应用** | 1个 | Vue3 + Element Plus |
| **总计** | **14个** | 完整系统组件 |

### 微服务清单（10个）
| # | 服务名称 | 端口 | 状态 | 职责 | 技术栈 |
|---|---------|------|------|------|--------|
| 1 | **gateway-service** | 8080 | ✅ 完整 | API网关、路由转发、限流熔断 | Spring Cloud Gateway |
| 2 | **auth-service** | 8081 | ✅ **新增** | 统一认证、JWT令牌管理、会话控制 | Spring Security + JWT + Redis |
| 3 | **user-service** | 8082 | ✅ 完整 | 用户管理、个人信息、权限管理 | MyBatis Plus + MySQL |
| 4 | **product-service** | 8083 | ✅ 完整 | 商品管理、库存管理、分类管理 | MyBatis Plus + MySQL |
| 5 | **order-service** | 8084 | ✅ 完整 | 订单管理、订单状态、订单流转 | MyBatis Plus + MySQL + RabbitMQ |
| 6 | **payment-service** | 8085 | ✅ 完整 | 支付管理、支付回调、对账管理 | MyBatis Plus + MySQL |
| 7 | **admin-service** | 8086 | ✅ 完整 | 后台管理、系统配置、数据统计 | MyBatis Plus + MySQL |
| 8 | **merchant-service** | 8087 | ✅ 完整 | 商家管理、店铺管理、商家审核 | MyBatis Plus + MySQL |
| 9 | **cart-service** | 8088 | ✅ 完整 | 购物车管理、购物车同步 | MyBatis Plus + MySQL + Redis |
| 10 | **sms-service** | 8089 | ✅ 完整 | 短信发送、验证码管理、通知推送 | Redis |

### 基础设施（3个）
| # | 组件名称 | 端口 | 版本 | 用途 |
|---|---------|------|------|------|
| 1 | **MySQL** | 3307 | 8.0 | 关系型数据库（主数据存储） |
| 2 | **Redis** | 6379 | 6.x | 缓存、会话、消息队列 |
| 3 | **Nacos** | 8848 | 2.x | 服务注册与发现、配置管理 |

### 前端应用（1个）
| # | 应用名称 | 端口 | 技术栈 | 说明 |
|---|---------|------|--------|------|
| 1 | **frontend** | 5173 | Vue3 + Element Plus + Vite | 用户前端界面 |

### 核心特性
1. **智能服务发现**
   - ✅ 自动扫描所有微服务
   - ✅ 自动排除非服务模块
   - ✅ 新增服务自动识别
   - ✅ 零配置集成

2. **依赖关系管理**
   - ✅ 按优先级有序启动
   - ✅ 网关服务优先启动
   - ✅ 基础服务先于业务服务
   - ✅ 智能延迟控制

3. **完整监控体系**
   - ✅ 实时状态检查
   - ✅ 服务健康监测
   - ✅ 日志集中管理
   - ✅ 性能指标采集

4. **灵活扩展能力**
   - ✅ 支持动态添加服务
   - ✅ 配置化服务管理
   - ✅ 模块化架构设计
   - ✅ 松耦合服务通信

**Section sources**
- [SERVICE_COMPLETION_SUMMARY.md](file://SERVICE_COMPLETION_SUMMARY.md)