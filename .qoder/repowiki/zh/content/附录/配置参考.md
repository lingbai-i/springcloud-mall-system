# 配置参考

<cite>
**本文档引用的文件**  
- [application.yml](file://backend/admin-service/src/main/resources/application.yml)
- [application.yml](file://backend/auth-service/src/main/resources/application.yml)
- [application.yml](file://backend/cart-service/src/main/resources/application.yml)
- [application.yml](file://backend/gateway-service/src/main/resources/application.yml)
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml)
- [application.yml](file://backend/order-service/src/main/resources/application.yml)
- [application.yml](file://backend/payment-service/src/main/resources/application.yml)
- [application.yml](file://backend/product-service/src/main/resources/application.yml)
- [application.yml](file://backend/sms-service/src/main/resources/application.yml)
- [application.yml](file://backend/user-service/src/main/resources/application.yml)
- [docker-compose.yml](file://docker-compose.yml)
- [docker-compose-dev.yml](file://docker-compose-dev.yml)
- [prometheus.yml](file://config/prometheus.yml)
- [Constants.java](file://backend/common-core/src/main/java/com/mall/common/core/constant/Constants.java)
</cite>

## 目录
1. [简介](#简介)
2. [Spring Boot 应用配置](#spring-boot-应用配置)
3. [Docker 编排配置](#docker-编排配置)
4. [监控系统配置](#监控系统配置)
5. [公共常量定义](#公共常量定义)
6. [环境差异与最佳实践](#环境差异与最佳实践)

## 简介
本手册汇总了在线商城系统中所有关键配置文件的内容和作用，涵盖Spring Boot应用配置、Docker编排配置、Prometheus监控配置以及公共常量定义。通过分类说明服务端口、数据库连接、Redis设置、JWT密钥、Nacos地址、消息队列参数等核心配置项，帮助开发和运维人员快速定位和调整系统行为。

## Spring Boot 应用配置

### 服务端口与基础信息
各微服务通过`server.port`指定独立端口，确保服务间隔离。`spring.application.name`定义服务名称，用于Nacos注册与服务发现。

**Section sources**
- [application.yml](file://backend/admin-service/src/main/resources/application.yml#L1-L7)
- [application.yml](file://backend/auth-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/cart-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/gateway-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/order-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/payment-service/src/main/resources/application.yml#L1-L8)
- [application.yml](file://backend/product-service/src/main/resources/application.yml#L1-L6)
- [application.yml](file://backend/sms-service/src/main/resources/application.yml#L1-L8)
- [application.yml](file://backend/user-service/src/main/resources/application.yml#L1-L6)

### 数据库连接配置
各服务通过`spring.datasource`配置MySQL连接，使用HikariCP连接池提升性能。URL中指定时区（GMT%2B8或Asia/Shanghai）、字符编码（UTF-8）及SSL设置。

**Section sources**
- [application.yml](file://backend/admin-service/src/main/resources/application.yml#L11-L23)
- [application.yml](file://backend/cart-service/src/main/resources/application.yml#L10-L23)
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml#L11-L15)
- [application.yml](file://backend/order-service/src/main/resources/application.yml#L17-L21)
- [application.yml](file://backend/product-service/src/main/resources/application.yml#L10-L15)
- [application.yml](file://backend/sms-service/src/main/resources/application.yml#L23-L35)
- [application.yml](file://backend/user-service/src/main/resources/application.yml#L10-L16)

### Redis 缓存配置
通过`spring.data.redis`或`spring.redis`配置Redis连接，指定主机、端口、数据库索引和连接池参数。不同服务使用不同数据库避免冲突。

**Section sources**
- [application.yml](file://backend/admin-service/src/main/resources/application.yml#L25-L37)
- [application.yml](file://backend/auth-service/src/main/resources/application.yml#L10-L23)
- [application.yml](file://backend/cart-service/src/main/resources/application.yml#L25-L38)
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml#L24-L35)
- [application.yml](file://backend/order-service/src/main/resources/application.yml#L30-L41)
- [application.yml](file://backend/payment-service/src/main/resources/application.yml#L39-L51)
- [application.yml](file://backend/sms-service/src/main/resources/application.yml#L36-L48)
- [application.yml](file://backend/user-service/src/main/resources/application.yml#L17-L30)

### Nacos 注册与配置中心
通过`spring.cloud.nacos`配置Nacos服务发现和配置管理，指定服务器地址、命名空间和分组。部分服务在开发模式下禁用配置中心功能。

**Section sources**
- [application.yml](file://backend/admin-service/src/main/resources/application.yml#L39-L46)
- [application.yml](file://backend/auth-service/src/main/resources/application.yml#L25-L32)
- [application.yml](file://backend/cart-service/src/main/resources/application.yml#L40-L53)
- [application.yml](file://backend/gateway-service/src/main/resources/application.yml#L13-L22)
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml#L36-L45)
- [application.yml](file://backend/order-service/src/main/resources/application.yml#L8-L16)
- [application.yml](file://backend/sms-service/src/main/resources/application.yml#L11-L21)
- [application.yml](file://backend/user-service/src/main/resources/application.yml#L35-L47)

### JWT 安全配置
`jwt`配置块定义密钥、有效期和签发者。`auth-service`和`user-service`使用高强度密钥实现令牌生成与验证，确保系统安全。

**Section sources**
- [application.yml](file://backend/admin-service/src/main/resources/application.yml#L62-L65)
- [application.yml](file://backend/auth-service/src/main/resources/application.yml#L33-L42)
- [application.yml](file://backend/user-service/src/main/resources/application.yml#L64-L68)

### 业务服务特定配置
#### 订单服务配置
`order-service`定义订单超时时间、自动确认收货天数、订单号前缀和分布式锁超时时间，确保订单流程的自动化与一致性。

**Section sources**
- [application.yml](file://backend/order-service/src/main/resources/application.yml#L68-L80)

#### 支付服务配置
`payment-service`配置支付宝和微信支付参数，包括App ID、密钥、网关URL和通知回调地址，支持多渠道支付集成。

**Section sources**
- [application.yml](file://backend/payment-service/src/main/resources/application.yml#L53-L72)

#### 商家服务配置
`merchant-service`定义商家审核策略（是否自动审核、审核过期天数）和佣金比例，支持灵活的商家管理规则。

**Section sources**
- [application.yml](file://backend/merchant-service/src/main/resources/application.yml#L47-L53)

#### 短信服务配置
`sms-service`配置验证码长度、过期时间、频率限制和第三方推送服务参数，保障短信发送的安全性与稳定性。

**Section sources**
- [application.yml](file://backend/sms-service/src/main/resources/application.yml#L69-L95)

#### 网关路由配置
`gateway-service`通过`spring.cloud.gateway.routes`定义多个路由规则，将前端请求转发至对应微服务，并通过StripPrefix过滤器去除路径前缀。

**Section sources**
- [application.yml](file://backend/gateway-service/src/main/resources/application.yml#L23-L112)

## Docker 编排配置

### 基础设施服务
`docker-compose.yml`定义MySQL、Redis、Nacos、Sentinel、RocketMQ、Elasticsearch、MinIO、Prometheus、Grafana、RabbitMQ等基础设施服务，通过Docker网络`mall-network`互联。

**Section sources**
- [docker-compose.yml](file://docker-compose.yml#L9-L228)

### 业务微服务容器化
各微服务以JAR包方式运行于独立容器中，通过环境变量注入配置（如`SPRING_PROFILES_ACTIVE`、`SPRING_CLOUD_NACOS_DISCOVERY_SERVER_ADDR`），实现配置与环境解耦。

**Section sources**
- [docker-compose.yml](file://docker-compose.yml#L229-L452)

### 前端服务编排
前端服务使用Node.js镜像，挂载本地代码目录，通过`npm run dev -- --host 0.0.0.0`启动开发服务器并暴露5173端口。

**Section sources**
- [docker-compose.yml](file://docker-compose.yml#L453-L467)

### 开发环境专用编排
`docker-compose-dev.yml`仅启动MySQL、Redis、Nacos等基础设施，便于本地开发调试，避免资源浪费。

**Section sources**
- [docker-compose-dev.yml](file://docker-compose-dev.yml#L7-L78)

## 监控系统配置

### Prometheus 抓取配置
`prometheus.yml`定义全局抓取间隔为15秒，配置多个抓取任务：
- `prometheus`：监控Prometheus自身
- `spring-boot-apps`：通过`/actuator/prometheus`端点收集Spring Boot应用指标
- `mysql`、`redis`、`elasticsearch`、`node`：分别监控数据库、缓存、搜索引擎和主机系统

**Section sources**
- [prometheus.yml](file://config/prometheus.yml#L1-L45)

## 公共常量定义

### 字符集与协议常量
定义UTF-8、GBK字符集，HTTP/HTTPS协议前缀，便于统一编码处理。

**Section sources**
- [Constants.java](file://backend/common-core/src/main/java/com/mall/common/core/constant/Constants.java#L8-L31)

### 系统状态常量
定义通用成功（"0"）与失败（"1"）标识，登录成功、失败、注销、注册等状态码，确保系统响应一致性。

**Section sources**
- [Constants.java](file://backend/common-core/src/main/java/com/mall/common/core/constant/Constants.java#L33-L61)

### 安全与令牌常量
定义JWT相关常量，包括令牌前缀（Bearer）、用户ID、用户名、权限、创建时间等字段名，支持统一身份认证。

**Section sources**
- [Constants.java](file://backend/common-core/src/main/java/com/mall/common/core/constant/Constants.java#L70-L106)

### 资源与安全限制
定义资源映射路径前缀（/profile），RMI/LDAP远程调用标识，以及定时任务白名单和违规字符，增强系统安全性。

**Section sources**
- [Constants.java](file://backend/common-core/src/main/java/com/mall/common/core/constant/Constants.java#L108-L137)

## 环境差异与最佳实践

### 开发与生产环境差异
- **数据库连接**：开发环境使用本地MySQL（localhost:3307），生产环境应使用独立数据库实例。
- **Redis配置**：开发环境无密码，生产环境需设置强密码并启用SSL。
- **JWT密钥**：开发环境使用固定密钥，生产环境必须使用高强度随机密钥并定期轮换。
- **Nacos命名空间**：开发使用`simple`，生产应使用`prod`等独立命名空间隔离配置。
- **敏感信息**：数据库密码、支付密钥等应通过环境变量或密钥管理服务注入，避免硬编码。

### 配置修改注意事项
1. 修改端口时需同步更新Docker编排文件和网关路由配置。
2. 调整Redis数据库索引时需确保各服务间无冲突。
3. 更改Nacos地址后需重启服务以重新注册。
4. 修改JWT密钥将导致所有现有令牌失效，需提前通知用户重新登录。
5. 调整订单超时时间需评估对库存锁定和用户体验的影响。

### 最佳实践建议
- 使用`application-{profile}.yml`实现多环境配置分离。
- 敏感配置项通过环境变量注入，避免提交至代码仓库。
- 定期审查和更新安全相关配置（如JWT密钥、Redis密码）。
- 利用Nacos配置中心实现配置动态更新，减少服务重启。
- 为关键配置添加注释说明，提升可维护性。