# 核心功能

<cite>
**Referenced Files in This Document**   
- [UserController.java](file://backend/user-service/src/main/java/com/mall/user/controller/UserController.java)
- [ProductController.java](file://backend/product-service/src/main/java/com/mall/product/controller/ProductController.java)
- [OrderController.java](file://backend/order-service/src/main/java/com/mall/order/controller/OrderController.java)
- [PaymentController.java](file://backend/payment-service/src/main/java/com/mall/payment/controller/PaymentController.java)
- [CartController.java](file://backend/cart-service/src/main/java/com/mall/cart/controller/CartController.java)
- [MerchantController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantController.java)
- [MerchantProductController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantProductController.java)
- [MerchantOrderController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantOrderController.java)
- [MerchantApplicationController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantApplicationController.java)
- [MerchantApprovalController.java](file://backend/admin-service/src/main/java/com/mall/admin/controller/MerchantApprovalController.java)
- [UserManagementController.java](file://backend/admin-service/src/main/java/com/mall/admin/controller/UserManagementController.java)
- [system实现报告.md](file://系统实现报告.md)
- [在线商城需求说明.md](file://在线商城需求说明.md)
- [README.md](file://README.md)
</cite>

## 目录
1. [用户系统](#用户系统)
2. [商品系统](#商品系统)
3. [订单系统](#订单系统)
4. [支付系统](#支付系统)
5. [购物车系统](#购物车系统)
6. [商家系统](#商家系统)
7. [管理系统](#管理系统)

## 用户系统

用户系统是电商平台的基础模块，负责管理所有用户的注册、登录、信息维护和安全认证。该系统支持用户通过用户名、邮箱或手机号进行注册和登录，并提供密码修改、头像上传、个人信息更新等核心功能。

**主要业务流程**:
- **注册流程**: 用户填写注册信息（用户名、密码、邮箱/手机号）→ 系统验证信息唯一性 → 创建用户账户并自动生成JWT令牌 → 返回登录成功信息。
- **登录流程**: 用户提交登录凭证 → 系统验证用户名和密码 → 生成访问令牌和刷新令牌 → 返回用户信息和令牌。
- **信息维护流程**: 用户请求获取个人信息 → 系统从数据库查询用户信息 → 返回用户详情；用户提交信息更新请求 → 系统验证并更新数据库记录。

**关键实体**:
- `User`: 用户实体，包含用户ID、用户名、密码、邮箱、手机号、头像URL等基本信息。
- `LoginRequest`: 登录请求DTO，包含用户名和密码。
- `RegisterRequest`: 注册请求DTO，包含用户名、密码、确认密码、邮箱、手机号等。
- `UserInfoResponse`: 用户信息响应VO，包含用户详细信息。

**核心控制器**:
- `UserController`: 处理所有用户相关的HTTP请求，包括注册、登录、信息获取与更新、密码修改、头像上传等。

**Section sources**
- [UserController.java](file://backend/user-service/src/main/java/com/mall/user/controller/UserController.java#L26-L838)

## 商品系统

商品系统是电商平台的核心，负责管理所有商品的生命周期，包括商品的发布、上下架、分类、搜索和库存管理。系统采用SPU（标准产品单位）和SKU（库存保有单位）的标准化模型来管理商品。

**主要业务流程**:
- **商品发布流程**: 商家填写商品信息（名称、描述、价格、分类、规格）→ 上传商品图片 → 提交发布 → 系统创建商品记录并上架。
- **商品搜索流程**: 用户输入关键词 → 系统在商品名称、描述、分类等字段进行全文搜索 → 返回匹配的商品列表。
- **库存管理流程**: 系统监控商品库存 → 当库存低于预警阈值时发出告警 → 商家进行库存补充。

**关键实体**:
- `Product`: 商品实体，包含商品ID、名称、描述、价格、库存、状态等信息。
- `ProductSku`: 商品SKU实体，管理商品的多规格（如颜色、尺寸）和对应的价格与库存。
- `ProductQueryDto`: 商品查询DTO，用于高级搜索的查询条件封装。
- `ProductDetailDto`: 商品详情DTO，包含商品基本信息和其所有SKU列表。

**核心控制器**:
- `ProductController`: 提供商品相关的REST API，包括商品的增删改查、搜索、库存和价格管理。

**Section sources**
- [ProductController.java](file://backend/product-service/src/main/java/com/mall/product/controller/ProductController.java#L26-L692)

## 订单系统

订单系统负责处理用户从下单到订单完成的整个生命周期。它管理订单的创建、状态流转、支付、发货、收货和退款等核心业务。

**主要业务流程**:
- **订单创建流程**: 用户从购物车结算 → 系统校验商品库存和价格 → 创建订单记录 → 返回订单详情。
- **订单状态流转**: 订单状态按 `待支付` → `待发货` → `待收货` → `已完成` 的流程进行流转。
- **订单取消流程**: 用户在支付前可取消订单 → 系统将订单状态更新为“已取消” → 释放占用的库存。
- **退款流程**: 用户申请退款 → 商家审核 → 系统处理退款并更新订单状态。

**关键实体**:
- `Order`: 订单实体，包含订单ID、用户ID、总金额、状态、收货地址等。
- `OrderItem`: 订单项实体，记录订单中每个商品的详细信息（商品ID、数量、单价）。
- `OrderStatus`: 订单状态枚举，定义了订单的所有可能状态。
- `CreateOrderRequest`: 创建订单请求DTO，包含用户ID、收货地址、订单项列表等。

**核心控制器**:
- `OrderController`: 处理订单相关的所有操作，如创建订单、获取订单列表、取消订单、确认收货、申请退款等。

**Section sources**
- [OrderController.java](file://backend/order-service/src/main/java/com/mall/order/controller/OrderController.java#L18-L250)

## 支付系统

支付系统负责处理平台内的所有支付交易，支持多种支付渠道（如支付宝、微信支付），并确保支付过程的安全性和可靠性。

**主要业务流程**:
- **支付流程**: 用户选择订单并发起支付 → 系统创建支付订单 → 调用第三方支付平台接口 → 返回支付信息（如二维码或跳转链接）→ 用户完成支付。
- **支付回调流程**: 第三方支付平台通知支付结果 → 系统验证回调信息 → 更新订单状态为“已支付” → 通知订单系统。
- **退款流程**: 用户申请退款 → 系统创建退款订单 → 调用支付渠道的退款接口 → 处理退款结果。

**关键实体**:
- `PaymentOrder`: 支付订单实体，关联业务订单，记录支付金额、状态、支付方式等。
- `PaymentStatus`: 支付状态枚举，如待支付、支付成功、支付失败、已退款。
- `PaymentCreateRequest`: 创建支付订单的请求DTO。
- `PaymentOrderResponse`: 支付订单响应DTO，包含支付所需的详细信息。

**核心控制器**:
- `PaymentController`: 提供支付相关的API，包括创建支付订单、发起支付、查询支付状态、处理支付回调等。

**Section sources**
- [PaymentController.java](file://backend/payment-service/src/main/java/com/mall/payment/controller/PaymentController.java#L57-L526)

## 购物车系统

购物车系统允许用户将感兴趣的商品暂时存放，以便后续统一结算。它支持商品的增删改查、数量调整、选中状态管理以及跨设备同步。

**主要业务流程**:
- **添加商品流程**: 用户点击“加入购物车” → 系统检查商品是否存在 → 将商品信息（商品ID、数量、规格）添加到用户的购物车中。
- **更新商品流程**: 用户修改购物车中商品的数量或选中状态 → 系统更新购物车记录。
- **结算流程**: 用户选择购物车中的商品进行结算 → 系统生成订单预览 → 引导用户进入订单创建流程。

**关键实体**:
- `CartItem`: 购物车项实体，包含用户ID、商品ID、数量、是否选中等。
- `CartService`: 购物车服务接口，定义了添加、更新、删除、查询等核心方法。

**核心控制器**:
- `CartController`: 处理购物车的所有操作，如添加商品、更新数量、删除商品、获取购物车列表、清空购物车等。

**Section sources**
- [CartController.java](file://backend/cart-service/src/main/java/com/mall/cart/controller/CartController.java#L20-L149)

## 商家系统

商家系统为平台上的商家提供了一套完整的店铺管理工具，包括商家入驻、店铺管理、商品管理、订单处理和数据统计。

**主要业务流程**:
- **商家入驻流程**: 商家提交入驻申请（主体信息、资质文件、银行账户）→ 平台管理员审核 → 审核通过后商家开店成功。
- **商品管理流程**: 商家发布新商品 → 设置商品信息和库存 → 上架商品 → 用户可浏览和购买。
- **订单处理流程**: 商家查看新订单 → 处理发货（填写物流信息）→ 用户确认收货 → 订单完成。

**关键实体**:
- `Merchant`: 商家实体，包含商家ID、用户名、店铺名称、联系方式、审核状态等。
- `MerchantApplication`: 商家入驻申请实体，记录申请的详细信息和审核状态。
- `MerchantProduct`: 商家商品实体，扩展了基础商品信息以关联商家。
- `MerchantOrder`: 商家订单实体，用于商家端查询和处理订单。

**核心控制器**:
- `MerchantController`: 处理商家的注册、登录、信息管理。
- `MerchantProductController`: 处理商家商品的增删改查、上下架、库存管理。
- `MerchantOrderController`: 处理商家订单的查询、发货、退款处理。
- `MerchantApplicationController`: 处理商家入驻申请的提交和查询。

**Section sources**
- [MerchantController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantController.java#L21-L418)
- [MerchantProductController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantProductController.java#L27-L618)
- [MerchantOrderController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantOrderController.java#L22-L469)
- [MerchantApplicationController.java](file://backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantApplicationController.java#L17-L203)

## 管理系统

管理系统为平台管理员提供用户、商家、内容和系统的全面管理能力，确保平台的稳定运行和合规性。

**主要业务流程**:
- **用户管理流程**: 管理员查询用户列表 → 查看用户详情 → 对违规用户进行禁用或启用操作。
- **商家审核流程**: 管理员查看商家入驻申请列表 → 审核申请资料 → 批准或拒绝申请。
- **系统监控流程**: 管理员查看系统健康状态、服务性能指标和调用链日志，及时发现和处理异常。

**关键实体**:
- `Admin`: 管理员实体，包含管理员ID、用户名、角色等。
- `Role`: 角色实体，定义了不同管理员角色的权限。
- `AuditLog`: 审计日志实体，记录关键操作（如审核、禁用）的详细信息。

**核心控制器**:
- `UserManagementController`: 处理用户列表查询、用户详情获取、用户禁用/启用等操作。
- `MerchantApprovalController`: 处理商家入驻申请的审批流程，包括获取申请列表、详情和执行审批。

**Section sources**
- [UserManagementController.java](file://backend/admin-service/src/main/java/com/mall/admin/controller/UserManagementController.java#L12-L77)
- [MerchantApprovalController.java](file://backend/admin-service/src/main/java/com/mall/admin/controller/MerchantApprovalController.java#L15-L146)