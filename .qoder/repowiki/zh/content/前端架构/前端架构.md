# 前端架构

<cite>
**本文档引用文件**  
- [vite.config.js](file://frontend/vite.config.js)
- [index.js](file://frontend/src/router/index.js)
- [user.js](file://frontend/src/stores/user.js)
- [cart.js](file://frontend/src/stores/cart.js)
- [request.js](file://frontend/src/utils/request.js)
- [index.vue](file://frontend/src/layout/index.vue)
- [admin/index.vue](file://frontend/src/layout/admin/index.vue)
- [merchant/index.vue](file://frontend/src/layout/merchant/index.vue)
- [api/auth.js](file://frontend/src/api/auth.js)
- [api/admin.js](file://frontend/src/api/admin.js)
- [api/merchant.js](file://frontend/src/api/merchant.js)
</cite>

## 目录
1. [项目结构](#项目结构)
2. [Vue组件体系](#vue组件体系)
3. [路由配置](#路由配置)
4. [状态管理](#状态管理)
5. [API调用封装](#api调用封装)
6. [构建工具](#构建工具)
7. [多布局实现](#多布局实现)
8. [权限控制机制](#权限控制机制)
9. [UI组件库集成](#ui组件库集成)
10. [核心模块调用关系](#核心模块调用关系)
11. [数据流示意图](#数据流示意图)

## 项目结构

前端项目采用基于Vue3的模块化结构，主要目录包括：
- `src/api`：API接口封装
- `src/components`：通用组件
- `src/layout`：页面布局组件
- `src/router`：路由配置
- `src/stores`：Pinia状态管理
- `src/styles`：全局样式
- `src/utils`：工具函数
- `src/views`：视图组件
- `src/main.js`：应用入口

项目通过Vite构建，采用模块化设计，各功能模块职责清晰，便于维护和扩展。

**Section sources**
- [vite.config.js](file://frontend/vite.config.js)
- [main.js](file://frontend/src/main.js)

## Vue组件体系

前端采用Vue3的组合式API和单文件组件（SFC）架构。组件体系分为：
- 布局组件（Layout）：提供页面基本结构
- 视图组件（Views）：具体页面实现
- 通用组件（Components）：可复用UI元素
- 功能组件（Stores）：状态管理

组件间通过props、emit、provide/inject和Pinia进行通信，形成清晰的组件树结构。

**Section sources**
- [App.vue](file://frontend/src/App.vue)
- [components](file://frontend/src/components)
- [views](file://frontend/src/views)

## 路由配置

基于Vue Router实现前端路由管理，采用动态导入和懒加载优化性能。

```mermaid
flowchart TD
A[根路由] --> B[用户端布局]
A --> C[管理员端布局]
A --> D[商家端布局]
B --> B1[首页]
B --> B2[商品列表]
B --> B3[购物车]
B --> B4[个人中心]
C --> C1[仪表板]
C --> C2[用户管理]
C --> C3[商家管理]
C --> C4[商品审核]
C --> C5[订单管理]
D --> D1[仪表板]
D --> D2[商品管理]
D --> D3[订单管理]
D --> D4[店铺管理]
D --> D5[营销工具]
```

**Diagram sources**
- [index.js](file://frontend/src/router/index.js)
- [index.vue](file://frontend/src/layout/index.vue)
- [admin/index.vue](file://frontend/src/layout/admin/index.vue)
- [merchant/index.vue](file://frontend/src/layout/merchant/index.vue)

**Section sources**
- [index.js](file://frontend/src/router/index.js)

## 状态管理

使用Pinia作为状态管理方案，实现响应式数据流。

```mermaid
classDiagram
class UserStore {
+token : string
+userInfo : Object
+isLoggedIn : boolean
+username : string
+avatar : string
+userId : string
+merchantId : string
+isAdmin : boolean
+isMerchant : boolean
+login(loginData)
+userRegister(registerData)
+logout()
+updateUserInfo(newUserInfo)
+fetchUserInfo()
+initUserState()
}
class CartStore {
+cartItems : Array
+loading : boolean
+totalCount : number
+totalPrice : number
+fetchCartItems()
+addToCart(productId, quantity)
+updateQuantity(productId, quantity)
+removeFromCart(productId)
+toggleSelect(productId, selected)
+clearCart()
}
UserStore --> CartStore : "依赖"
```

**Diagram sources**
- [user.js](file://frontend/src/stores/user.js)
- [cart.js](file://frontend/src/stores/cart.js)

**Section sources**
- [user.js](file://frontend/src/stores/user.js)
- [cart.js](file://frontend/src/stores/cart.js)

## API调用封装

基于axios封装统一的API请求层，实现请求拦截、响应处理和错误管理。

```mermaid
sequenceDiagram
participant Component as "组件"
participant Store as "Pinia Store"
participant API as "API模块"
participant Axios as "Axios实例"
participant Backend as "后端服务"
Component->>Store : 调用业务方法
Store->>API : 调用API接口
API->>Axios : 发起HTTP请求
Axios->>Axios : 请求拦截器
Axios->>Backend : 发送请求
Backend-->>Axios : 返回响应
Axios->>Axios : 响应拦截器
Axios-->>API : 返回处理结果
API-->>Store : 返回数据
Store-->>Component : 返回最终结果
```

**Diagram sources**
- [request.js](file://frontend/src/utils/request.js)
- [auth.js](file://frontend/src/api/auth.js)
- [admin.js](file://frontend/src/api/admin.js)
- [merchant.js](file://frontend/src/api/merchant.js)

**Section sources**
- [request.js](file://frontend/src/utils/request.js)

## 构建工具

使用Vite作为构建工具，提供快速的开发服务器和高效的生产构建。

```mermaid
flowchart LR
A[Vite配置] --> B[插件系统]
A --> C[开发服务器]
A --> D[生产构建]
B --> B1[vue插件]
B --> B2[自动导入]
B --> B3[组件自动注册]
B --> B4[Element Plus解析器]
C --> C1[端口5173]
C --> C2[主机访问]
C --> C3[代理配置]
C3 --> C31[/api → 网关8080]
C3 --> C32[/api/sms → 短信服务8083]
D --> D1[代码分割]
D --> D2[Tree Shaking]
D --> D3[压缩优化]
```

**Diagram sources**
- [vite.config.js](file://frontend/vite.config.js)

**Section sources**
- [vite.config.js](file://frontend/vite.config.js)

## 多布局实现

系统实现三种不同的布局：用户端、管理员端和商家端，满足不同角色的使用需求。

```mermaid
classDiagram
class Layout {
<<abstract>>
+isCollapse : boolean
+activeMenu : string
+breadcrumbList : Array
+toggleCollapse()
}
class UserLayout {
+无侧边栏
+简单导航
}
class AdminLayout {
+深色侧边栏
+管理员菜单
+系统监控功能
}
class MerchantLayout {
+深色侧边栏
+商家功能菜单
+店铺管理功能
}
Layout <|-- UserLayout
Layout <|-- AdminLayout
Layout <|-- MerchantLayout
```

**Diagram sources**
- [index.vue](file://frontend/src/layout/index.vue)
- [admin/index.vue](file://frontend/src/layout/admin/index.vue)
- [merchant/index.vue](file://frontend/src/layout/merchant/index.vue)

**Section sources**
- [index.vue](file://frontend/src/layout/index.vue)
- [admin/index.vue](file://frontend/src/layout/admin/index.vue)
- [merchant/index.vue](file://frontend/src/layout/merchant/index.vue)

## 权限控制机制

通过路由元信息和Pinia状态实现多层次权限控制。

```mermaid
flowchart TD
A[路由跳转] --> B{检查requiresAuth}
B --> |是| C{用户是否登录}
C --> |否| D[跳转登录页]
C --> |是| E{检查requiresAdmin}
E --> |是| F{是否管理员}
F --> |否| G[提示无权限]
F --> |是| H[允许访问]
E --> |否| I{检查requiresMerchant}
I --> |是| J{是否商家}
J --> |否| K[提示无权限]
J --> |是| H
I --> |否| H
B --> |否| H
```

**Diagram sources**
- [index.js](file://frontend/src/router/index.js)
- [user.js](file://frontend/src/stores/user.js)

**Section sources**
- [index.js](file://frontend/src/router/index.js)
- [user.js](file://frontend/src/stores/user.js)

## UI组件库集成

集成Element Plus作为UI组件库，通过unplugin-vue-components实现按需加载和自动导入。

```mermaid
flowchart LR
A[Element Plus] --> B[unplugin-auto-import]
A --> C[unplugin-vue-components]
B --> D[自动导入API]
C --> E[自动注册组件]
D --> F[Vue API]
D --> G[Vue Router]
D --> H[Pinia]
E --> I[Element Plus解析器]
I --> J[按需加载]
```

**Diagram sources**
- [vite.config.js](file://frontend/vite.config.js)

**Section sources**
- [vite.config.js](file://frontend/vite.config.js)

## 核心模块调用关系

展示前端核心模块间的调用关系和依赖结构。

```mermaid
graph TD
A[视图组件] --> B[Pinia Store]
B --> C[API模块]
C --> D[Axios实例]
D --> E[后端微服务]
A --> F[路由系统]
F --> G[布局组件]
G --> A
B --> H[本地存储]
D --> I[请求拦截器]
D --> J[响应拦截器]
I --> K[认证头添加]
I --> L[CSRF防护]
J --> M[错误处理]
J --> N[成功提示]
```

**Diagram sources**
- [user.js](file://frontend/src/stores/user.js)
- [cart.js](file://frontend/src/stores/cart.js)
- [request.js](file://frontend/src/utils/request.js)
- [index.js](file://frontend/src/router/index.js)

**Section sources**
- [user.js](file://frontend/src/stores/user.js)
- [cart.js](file://frontend/src/stores/cart.js)
- [request.js](file://frontend/src/utils/request.js)

## 数据流示意图

展示前端与后端微服务交互的数据流。

```mermaid
flowchart LR
A[前端应用] --> B[API网关8080]
A --> C[短信服务8083]
B --> D[用户服务]
B --> E[商品服务]
B --> F[订单服务]
B --> G[购物车服务]
B --> H[商家服务]
B --> I[支付服务]
D --> J[数据库]
E --> J
F --> J
G --> J
H --> J
I --> J
C --> K[短信服务数据库]
```

**Diagram sources**
- [vite.config.js](file://frontend/vite.config.js)

**Section sources**
- [vite.config.js](file://frontend/vite.config.js)