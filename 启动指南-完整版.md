# SpringCloud商城项目 - 完整启动指南

## 📋 项目概览

这是一个基于 **Spring Cloud Alibaba** 的微服务在线商城系统，包含10个微服务模块。

### 技术栈
- **后端**: Java 17, Spring Boot 3.1.12, Spring Cloud Alibaba 2022.0.0.0
- **注册中心**: Nacos 2.3.0
- **数据库**: MySQL 8.0
- **缓存**: Redis 7
- **前端**: Vue 3 + Vite + Element Plus

### 微服务列表
1. gateway-service (8080) - API网关
2. auth-service (8081) - 认证服务
3. user-service (8082) - 用户服务
4. product-service (8083) - 商品服务
5. order-service (8084) - 订单服务
6. payment-service (8085) - 支付服务
7. admin-service (8086) - 管理服务
8. merchant-service (8087) - 商家服务
9. cart-service (8088) - 购物车服务
10. sms-service (8089) - 短信服务

---

## 🚀 启动步骤

### 步骤1: 启动基础设施（Docker）

```powershell
# 进入项目目录
cd d:\code\springcloud-mall\springcloud-mall

# 启动 MySQL、Redis、Nacos
docker compose -f docker-compose-dev.yml up -d

# 等待容器启动（约30秒）
timeout /t 30

# 检查容器状态
docker compose -f docker-compose-dev.yml ps
```

**预期输出**：应该看到3个容器都是 `Up (healthy)` 状态
- mall-mysql-dev (端口 3307)
- mall-redis-dev (端口 6379)
- mall-nacos-dev (端口 8848)

### 步骤2: 验证基础设施

```powershell
# 访问 Nacos 控制台
# 浏览器打开: http://localhost:8848/nacos
# 账号: nacos  密码: nacos

# 检查 MySQL 数据库
docker exec -it mall-mysql-dev mysql -uroot -p123456 -e "SHOW DATABASES LIKE 'mall_%';"

# 检查 Redis
docker exec -it mall-redis-dev redis-cli ping
```

### 步骤3: 编译后端服务

```powershell
cd backend

# 编译所有模块（首次运行会下载依赖，需要5-10分钟）
mvn clean compile -DskipTests

# 或者直接打包
mvn clean package -DskipTests
```

### 步骤4: 启动微服务

**方式A: 使用 Maven 命令（推荐开发调试）**

打开多个 PowerShell 窗口，按顺序启动：

```powershell
# 窗口1: 网关服务（必须最先启动）
cd d:\code\springcloud-mall\springcloud-mall\backend\gateway-service
mvn spring-boot:run -Dspring-boot.run.profiles=simple

# 窗口2: 用户服务
cd d:\code\springcloud-mall\springcloud-mall\backend\user-service
mvn spring-boot:run

# 窗口3: 商品服务
cd d:\code\springcloud-mall\springcloud-mall\backend\product-service
mvn spring-boot:run

# 窗口4: 购物车服务
cd d:\code\springcloud-mall\springcloud-mall\backend\cart-service
mvn spring-boot:run

# 窗口5: 订单服务
cd d:\code\springcloud-mall\springcloud-mall\backend\order-service
mvn spring-boot:run

# 窗口6: 支付服务
cd d:\code\springcloud-mall\springcloud-mall\backend\payment-service
mvn spring-boot:run

# 窗口7: 商家服务
cd d:\code\springcloud-mall\springcloud-mall\backend\merchant-service
mvn spring-boot:run

# 窗口8: 管理服务
cd d:\code\springcloud-mall\springcloud-mall\backend\admin-service
mvn spring-boot:run

# 窗口9: 短信服务
cd d:\code\springcloud-mall\springcloud-mall\backend\sms-service
mvn spring-boot:run
```

**方式B: 使用 IntelliJ IDEA（推荐）**

1. 用 IDEA 打开 `backend` 目录
2. 等待 Maven 依赖下载完成
3. 找到各服务的主启动类（Application.java）
4. 右键 -> Run 启动各个服务

### 步骤5: 启动前端

```powershell
cd d:\code\springcloud-mall\springcloud-mall\frontend

# 首次运行需要安装依赖（需要5-10分钟）
npm install

# 启动开发服务器
npm run dev
```

---

## 🌐 访问地址

| 服务 | 地址 | 账号密码 |
|------|------|---------|
| 🎨 前端应用 | http://localhost:5173 | testlogin / nacos |
| 📡 API网关 | http://localhost:8080 | - |
| 🎯 Nacos控制台 | http://localhost:8848/nacos | nacos / nacos |
| 🗄️ MySQL | localhost:3307 | root / 123456 |
| 📊 Redis | localhost:6379 | - |

---

## 🔍 验证服务状态

```powershell
# 检查网关健康状态
curl http://localhost:8080/actuator/health

# 检查所有服务注册情况
# 访问 Nacos 控制台 -> 服务管理 -> 服务列表
# 应该看到所有启动的服务
```

---

## ⚠️ 常见问题

### 1. 端口被占用
```powershell
# 查看端口占用
netstat -ano | findstr :8080

# 结束进程
taskkill /PID <进程ID> /F
```

### 2. Nacos 连接失败
- 等待 Nacos 容器完全启动（约1-2分钟）
- 检查容器健康状态：`docker ps`
- 查看日志：`docker logs mall-nacos-dev`

### 3. Maven 下载依赖慢
配置阿里云镜像（已在 pom.xml 中配置）

### 4. 服务启动失败
- 检查日志输出
- 确保基础设施（MySQL、Redis、Nacos）已启动
- 确保端口未被占用

---

## 📝 日志位置

- **后端服务**: 控制台输出 或 `logs/` 目录
- **前端**: 浏览器开发者工具 Console
- **Docker**: `docker logs <容器名>`

---

## 🎯 快速测试

```powershell
# 测试网关
curl http://localhost:8080/actuator/health

# 访问前端
# 浏览器打开: http://localhost:5173
```

---

**提示**: 
- 首次启动需要下载依赖，耐心等待
- 建议使用 IntelliJ IDEA 启动后端服务
- 所有服务完全启动需要 3-5 分钟

