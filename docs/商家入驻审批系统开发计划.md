# å•†å®¶å…¥é©»å®¡æ‰¹ç³»ç»Ÿ - å®Œæ•´å¼€å‘è®¡åˆ’

> **é¡¹ç›®ç±»å‹**: å®Œæ•´åŠŸèƒ½æ¨¡å—å¼€å‘  
> **é¢„è®¡å·¥ä½œé‡**: 200+ å·¥å…·è°ƒç”¨ï¼Œçº¦ 1-1.5 å°æ—¶  
> **å¼€å§‹æ—¶é—´**: 2025-11-11  
> **çŠ¶æ€**: è¿›è¡Œä¸­

---

## ğŸ“Š ç°çŠ¶åˆ†æ

### âœ… å·²æœ‰åŸºç¡€æ¶æ„

ç³»ç»Ÿå·²ç»å…·å¤‡ä»¥ä¸‹ç»„ä»¶ï¼š

- **merchant-service** - å•†å®¶æœåŠ¡ï¼ˆ28 ä¸ª Java æ–‡ä»¶ï¼‰
- **admin-service** - ç®¡ç†æœåŠ¡
- **Merchant å®ä½“** - åŒ…å«å®¡æ ¸çŠ¶æ€ã€å®¡æ ¸åŸå› ã€å®¡æ ¸æ—¶é—´ç­‰å®Œæ•´å­—æ®µ
- **MerchantManagementController** - åŸºç¡€å®¡æ ¸æ¥å£æ¡†æ¶
- **mall_merchant æ•°æ®åº“** - å•†å®¶æ•°æ®å­˜å‚¨
- **SMS æœåŠ¡** - çŸ­ä¿¡é€šçŸ¥æœåŠ¡ï¼ˆå·²é›†æˆï¼‰
- **MinIO æœåŠ¡** - æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼ˆåˆšé…ç½®å®Œæˆï¼‰

---

## ğŸ¯ ç³»ç»Ÿæ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•†å®¶ç”³è¯·é¡µé¢    â”‚â”€â”€â”€â”€â”€>â”‚  Merchant API    â”‚â”€â”€â”€â”€â”€>â”‚  MySQLæ•°æ®åº“    â”‚
â”‚  (Vue)          â”‚      â”‚  (ç”³è¯·æäº¤)      â”‚      â”‚  (ç”³è¯·æ•°æ®)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  MinIOå­˜å‚¨   â”‚
                         â”‚  (è¯ä»¶å›¾ç‰‡)  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç®¡ç†å‘˜å®¡æ‰¹ç•Œé¢   â”‚<â”€â”€â”€â”€>â”‚   Admin API      â”‚â”€â”€â”€â”€â”€>â”‚   SMSæœåŠ¡       â”‚
â”‚  (Vue)          â”‚      â”‚  (å®¡æ‰¹æ“ä½œ)      â”‚      â”‚  (çŸ­ä¿¡é€šçŸ¥)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Phase 1: æ ¸å¿ƒç”³è¯·ä¸å®¡æ‰¹æµç¨‹ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

### 1.1 æ•°æ®åº“è¡¨è®¾è®¡

#### merchant_applications è¡¨ï¼ˆå•†å®¶å…¥é©»ç”³è¯·è¡¨ï¼‰

```sql
CREATE TABLE IF NOT EXISTS merchant_applications (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”³è¯·ID',

  -- ç”³è¯·åŸºæœ¬ä¿¡æ¯
  entity_type VARCHAR(20) NOT NULL COMMENT 'ä¸»ä½“ç±»å‹ï¼šenterprise/individual/personal',
  shop_type VARCHAR(20) COMMENT 'åº—é“ºç±»å‹ï¼šflagship/specialty/franchise/ordinary',
  shop_name VARCHAR(100) NOT NULL COMMENT 'åº—é“ºåç§°',

  -- è”ç³»ä¿¡æ¯
  contact_name VARCHAR(50) NOT NULL COMMENT 'è”ç³»äººå§“å',
  contact_phone VARCHAR(20) NOT NULL COMMENT 'è”ç³»ç”µè¯',
  email VARCHAR(100) COMMENT 'é‚®ç®±åœ°å€',

  -- ä¼ä¸š/ä¸ªä½“å·¥å•†æˆ·ä¿¡æ¯
  company_name VARCHAR(100) COMMENT 'ä¼ä¸š/ä¸ªä½“æˆ·åç§°',
  credit_code VARCHAR(18) COMMENT 'ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ',
  legal_person VARCHAR(50) COMMENT 'æ³•å®šä»£è¡¨äºº/ç»è¥è€…',
  business_license VARCHAR(500) COMMENT 'è¥ä¸šæ‰§ç…§å›¾ç‰‡URLï¼ˆMinIOï¼‰',

  -- ä¸ªäººä¿¡æ¯
  id_card VARCHAR(18) COMMENT 'èº«ä»½è¯å·',
  id_card_front VARCHAR(500) COMMENT 'èº«ä»½è¯æ­£é¢URLï¼ˆMinIOï¼‰',
  id_card_back VARCHAR(500) COMMENT 'èº«ä»½è¯åé¢URLï¼ˆMinIOï¼‰',

  -- è´¦å·ä¿¡æ¯
  username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç™»å½•è´¦å·',
  password VARCHAR(255) NOT NULL COMMENT 'ç™»å½•å¯†ç ï¼ˆBCryptåŠ å¯†ï¼‰',

  -- å®¡æ‰¹çŠ¶æ€
  approval_status INT DEFAULT 0 COMMENT 'å®¡æ‰¹çŠ¶æ€ï¼š0-å¾…å®¡æ ¸,1-å·²é€šè¿‡,2-å·²æ‹’ç»',
  approval_reason TEXT COMMENT 'å®¡æ‰¹æ„è§/æ‹’ç»åŸå› ',
  approval_time DATETIME COMMENT 'å®¡æ‰¹æ—¶é—´',
  approval_by BIGINT COMMENT 'å®¡æ‰¹äººIDï¼ˆadminç”¨æˆ·ï¼‰',

  -- å•†å®¶è´¦å·IDï¼ˆå®¡æ‰¹é€šè¿‡ååˆ›å»ºï¼‰
  merchant_id BIGINT COMMENT 'å…³è”çš„å•†å®¶ID',

  -- çŸ­ä¿¡é€šçŸ¥çŠ¶æ€
  sms_sent TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å·²å‘é€çŸ­ä¿¡ï¼š0-æœªå‘é€,1-å·²å‘é€',
  sms_sent_time DATETIME COMMENT 'çŸ­ä¿¡å‘é€æ—¶é—´',

  -- æ—¶é—´æˆ³
  created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ç”³è¯·æäº¤æ—¶é—´',
  updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

  -- ç´¢å¼•
  INDEX idx_approval_status (approval_status),
  INDEX idx_contact_phone (contact_phone),
  INDEX idx_created_time (created_time),
  INDEX idx_username (username)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å®¶å…¥é©»ç”³è¯·è¡¨';
```

#### merchant_approval_logs è¡¨ï¼ˆå®¡æ‰¹æ—¥å¿—è¡¨ï¼‰

```sql
CREATE TABLE IF NOT EXISTS merchant_approval_logs (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
  application_id BIGINT NOT NULL COMMENT 'ç”³è¯·ID',
  admin_id BIGINT NOT NULL COMMENT 'æ“ä½œç®¡ç†å‘˜ID',
  admin_username VARCHAR(50) COMMENT 'ç®¡ç†å‘˜ç”¨æˆ·å',
  action VARCHAR(20) NOT NULL COMMENT 'æ“ä½œï¼šapprove-é€šè¿‡, reject-æ‹’ç»',
  reason TEXT COMMENT 'æ“ä½œåŸå› ',
  ip_address VARCHAR(50) COMMENT 'æ“ä½œIPåœ°å€',
  created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ“ä½œæ—¶é—´',

  INDEX idx_application_id (application_id),
  INDEX idx_admin_id (admin_id),
  INDEX idx_created_time (created_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å•†å®¶å®¡æ‰¹æ“ä½œæ—¥å¿—è¡¨';
```

### 1.2 åç«¯ API å®ç°

#### æ–‡ä»¶æ¸…å•

1. **å®ä½“ç±»**

   - `MerchantApplication.java` - ç”³è¯·å®ä½“
   - `MerchantApprovalLog.java` - å®¡æ‰¹æ—¥å¿—å®ä½“

2. **DTO ç±»**

   - `MerchantApplicationRequest.java` - ç”³è¯·æäº¤è¯·æ±‚
   - `MerchantApplicationVO.java` - ç”³è¯·è¯¦æƒ…å“åº”
   - `ApprovalRequest.java` - å®¡æ‰¹æ“ä½œè¯·æ±‚

3. **Controller**

   - `MerchantApplicationController.java` - å•†å®¶ç”³è¯·æ¥å£
   - `AdminMerchantApprovalController.java` - ç®¡ç†å‘˜å®¡æ‰¹æ¥å£

4. **Service**

   - `MerchantApplicationService.java` - ç”³è¯·ä¸šåŠ¡é€»è¾‘
   - `MerchantApprovalService.java` - å®¡æ‰¹ä¸šåŠ¡é€»è¾‘

5. **Repository**
   - `MerchantApplicationRepository.java` - ç”³è¯·æ•°æ®è®¿é—®
   - `MerchantApprovalLogRepository.java` - æ—¥å¿—æ•°æ®è®¿é—®

#### æ ¸å¿ƒæ¥å£è®¾è®¡

##### 1. æäº¤ç”³è¯·æ¥å£

```
POST /api/merchants/apply
Content-Type: application/json

Request Body:
{
  "entityType": "enterprise",
  "shopType": "flagship",
  "shopName": "æµ‹è¯•æ——èˆ°åº—",
  "contactName": "å¼ ä¸‰",
  "contactPhone": "13800138000",
  "email": "test@example.com",
  "companyName": "æµ‹è¯•ç§‘æŠ€æœ‰é™å…¬å¸",
  "creditCode": "91110000MA001234AB",
  "legalPerson": "å¼ ä¸‰",
  "businessLicense": "http://localhost:9000/mall-avatars/file_123.jpg",
  "username": "merchant001",
  "password": "password123"
}

Response:
{
  "code": 200,
  "success": true,
  "message": "ç”³è¯·æäº¤æˆåŠŸ",
  "data": {
    "applicationId": 1,
    "shopName": "æµ‹è¯•æ——èˆ°åº—",
    "estimatedReviewTime": "1ä¸ªå·¥ä½œæ—¥"
  }
}
```

##### 2. æŸ¥è¯¢ç”³è¯·åˆ—è¡¨æ¥å£

```
GET /api/admin/merchants/applications
Query Parameters:
  - page: 1
  - size: 20
  - status: 0 (å¯é€‰ï¼š0-å¾…å®¡æ ¸,1-å·²é€šè¿‡,2-å·²æ‹’ç»)
  - keyword: "" (å¯é€‰ï¼šæœç´¢åº—é“ºåç§°/è”ç³»äºº)

Response:
{
  "code": 200,
  "success": true,
  "data": {
    "total": 50,
    "page": 1,
    "size": 20,
    "records": [
      {
        "id": 1,
        "shopName": "æµ‹è¯•æ——èˆ°åº—",
        "contactName": "å¼ ä¸‰",
        "contactPhone": "138****8000",
        "entityType": "enterprise",
        "shopType": "flagship",
        "approvalStatus": 0,
        "approvalStatusText": "å¾…å®¡æ ¸",
        "createdTime": "2025-11-11 18:00:00"
      }
    ]
  }
}
```

##### 3. å®¡æ‰¹æ“ä½œæ¥å£

```
PUT /api/admin/merchants/applications/{id}/approve
Content-Type: application/json
Authorization: Bearer {adminToken}

Request Body:
{
  "approved": true,  // true-é€šè¿‡, false-æ‹’ç»
  "reason": "ç¬¦åˆå…¥é©»æ¡ä»¶ï¼Œå®¡æ ¸é€šè¿‡"  // æ‹’ç»æ—¶å¿…å¡«
}

Response:
{
  "code": 200,
  "success": true,
  "message": "å®¡æ‰¹æ“ä½œæˆåŠŸ",
  "data": {
    "applicationId": 1,
    "approvalStatus": 1,
    "merchantId": 100,  // é€šè¿‡æ—¶è¿”å›åˆ›å»ºçš„å•†å®¶ID
    "smsS sent": true
  }
}
```

### 1.3 å‰ç«¯é¡µé¢å®ç°

#### é¡µé¢è·¯ç”±é…ç½®

```javascript
// router/index.js
{
  path: '/admin/merchants',
  children: [
    {
      path: 'applications',
      component: () => import('@/views/admin/merchants/applications.vue')
    }
  ]
}
```

#### ç»„ä»¶æ–‡ä»¶ç»“æ„

```
frontend/src/views/admin/merchants/
â”œâ”€â”€ applications.vue           # ç”³è¯·åˆ—è¡¨ä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ApplicationDetail.vue  # ç”³è¯·è¯¦æƒ…ç»„ä»¶
â”‚   â””â”€â”€ ApprovalDialog.vue     # å®¡æ‰¹å¯¹è¯æ¡†ç»„ä»¶
```

---

## ğŸ“± Phase 2: SMS é€šçŸ¥ä¸æƒé™ç®¡ç†

### 2.1 çŸ­ä¿¡é€šçŸ¥é›†æˆ

#### çŸ­ä¿¡æ¨¡æ¿è®¾è®¡

##### ç”³è¯·æäº¤ç¡®è®¤

```
ã€åœ¨çº¿å•†åŸã€‘æ‚¨çš„å•†å®¶å…¥é©»ç”³è¯·å·²æäº¤æˆåŠŸï¼
åº—é“ºåç§°ï¼š{shopName}
ç”³è¯·ç¼–å·ï¼š{applicationId}
é¢„è®¡å®¡æ ¸æ—¶é—´ï¼š1ä¸ªå·¥ä½œæ—¥
æˆ‘ä»¬å°†é€šè¿‡çŸ­ä¿¡é€šçŸ¥æ‚¨å®¡æ ¸ç»“æœã€‚
```

##### å®¡æ‰¹é€šè¿‡é€šçŸ¥

```
ã€åœ¨çº¿å•†åŸã€‘æ­å–œï¼æ‚¨çš„å•†å®¶å…¥é©»ç”³è¯·å·²å®¡æ ¸é€šè¿‡ï¼
åº—é“ºåç§°ï¼š{shopName}
ç™»å½•è´¦å·ï¼š{username}
è¯·è®¿é—®å•†å®¶åå°ï¼šhttp://localhost:5173/merchant/login
å¼€å¯æ‚¨çš„ç”µå•†ä¹‹æ—…ï¼
```

##### å®¡æ‰¹æ‹’ç»é€šçŸ¥

```
ã€åœ¨çº¿å•†åŸã€‘å¾ˆé—æ†¾ï¼Œæ‚¨çš„å•†å®¶å…¥é©»ç”³è¯·æœªé€šè¿‡å®¡æ ¸ã€‚
åº—é“ºåç§°ï¼š{shopName}
æ‹’ç»åŸå› ï¼š{reason}
å¦‚æœ‰ç–‘é—®è¯·è”ç³»å®¢æœï¼š400-xxx-xxxx
æ‚¨å¯ä»¥é‡æ–°æäº¤ç”³è¯·ã€‚
```

#### SMS æœåŠ¡é›†æˆä»£ç 

```java
// åœ¨ApprovalServiceä¸­é›†æˆSMS
@Autowired
private SmsService smsService;

private void sendApprovalSms(MerchantApplication app, boolean approved, String reason) {
    try {
        String phone = app.getContactPhone();
        String shopName = app.getShopName();

        if (approved) {
            // å‘é€é€šè¿‡é€šçŸ¥
            String message = String.format(
                "ã€åœ¨çº¿å•†åŸã€‘æ­å–œï¼æ‚¨çš„å•†å®¶å…¥é©»ç”³è¯·å·²å®¡æ ¸é€šè¿‡ï¼åº—é“ºåç§°ï¼š%sï¼Œç™»å½•è´¦å·ï¼š%s",
                shopName, app.getUsername()
            );
            smsService.sendNotification(phone, message);
        } else {
            // å‘é€æ‹’ç»é€šçŸ¥
            String message = String.format(
                "ã€åœ¨çº¿å•†åŸã€‘å¾ˆé—æ†¾ï¼Œæ‚¨çš„å•†å®¶å…¥é©»ç”³è¯·æœªé€šè¿‡å®¡æ ¸ã€‚åº—é“ºåç§°ï¼š%sï¼Œæ‹’ç»åŸå› ï¼š%s",
                shopName, reason
            );
            smsService.sendNotification(phone, message);
        }

        // æ›´æ–°çŸ­ä¿¡å‘é€çŠ¶æ€
        app.setSmsSent(1);
        app.setSmsSentTime(LocalDateTime.now());

    } catch (Exception e) {
        log.error("å‘é€å®¡æ‰¹çŸ­ä¿¡å¤±è´¥", e);
        // ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…å½±å“å®¡æ‰¹æµç¨‹
    }
}
```

### 2.2 æƒé™ç®¡ç†ç³»ç»Ÿ

#### å•†å®¶æƒé™é…ç½®

```java
// å®¡æ‰¹é€šè¿‡åçš„æƒé™é…ç½®
public void grantMerchantPermissions(Long merchantId) {
    // 1. åˆ›å»ºå•†å®¶è§’è‰²
    Role merchantRole = new Role();
    merchantRole.setName("ROLE_MERCHANT");
    merchantRole.setDescription("å•†å®¶è§’è‰²");

    // 2. åˆ†é…æƒé™
    List<String> permissions = Arrays.asList(
        "merchant:product:create",    // åˆ›å»ºå•†å“
        "merchant:product:edit",      // ç¼–è¾‘å•†å“
        "merchant:product:delete",    // åˆ é™¤å•†å“
        "merchant:order:view",        // æŸ¥çœ‹è®¢å•
        "merchant:order:process",     // å¤„ç†è®¢å•
        "merchant:stats:view"         // æŸ¥çœ‹ç»Ÿè®¡
    );

    // 3. ç»‘å®šæƒé™åˆ°å•†å®¶è´¦å·
    merchantRoleService.assignPermissions(merchantId, permissions);

    // 4. è®°å½•æƒé™å˜æ›´æ—¥å¿—
    logPermissionChange(merchantId, "GRANT_INITIAL", permissions);
}
```

---

## ğŸ”§ Phase 3: å¼‚å¸¸å¤„ç†ä¸æ–‡æ¡£

### 3.1 å¼‚å¸¸å¤„ç†æœºåˆ¶

#### æ•°æ®å®Œæ•´æ€§éªŒè¯

```java
@Service
public class ApplicationValidator {

    public void validateApplication(MerchantApplicationRequest request) {
        // 1. å¿…å¡«å­—æ®µæ£€æŸ¥
        Assert.notBlank(request.getShopName(), "åº—é“ºåç§°ä¸èƒ½ä¸ºç©º");
        Assert.notBlank(request.getContactPhone(), "è”ç³»ç”µè¯ä¸èƒ½ä¸ºç©º");

        // 2. æ‰‹æœºå·æ ¼å¼éªŒè¯
        if (!request.getContactPhone().matches("^1[3-9]\\d{9}$")) {
            throw new BusinessException("æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®");
        }

        // 3. æ ¹æ®ä¸»ä½“ç±»å‹éªŒè¯å¿…å¡«å­—æ®µ
        if ("enterprise".equals(request.getEntityType())) {
            Assert.notBlank(request.getCompanyName(), "ä¼ä¸šåç§°ä¸èƒ½ä¸ºç©º");
            Assert.notBlank(request.getCreditCode(), "ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç ä¸èƒ½ä¸ºç©º");
            Assert.notBlank(request.getBusinessLicense(), "è¯·ä¸Šä¼ è¥ä¸šæ‰§ç…§");
        }

        // 4. è´¦å·å”¯ä¸€æ€§æ£€æŸ¥
        if (applicationRepository.existsByUsername(request.getUsername())) {
            throw new BusinessException("è¯¥è´¦å·å·²è¢«ä½¿ç”¨");
        }
    }
}
```

#### äº‹åŠ¡å›æ»šé…ç½®

```java
@Transactional(rollbackFor = Exception.class)
public void approveApplication(Long id, ApprovalRequest request, Long adminId) {
    try {
        // å®¡æ‰¹é€»è¾‘...
    } catch (Exception e) {
        log.error("å®¡æ‰¹æ“ä½œå¤±è´¥ï¼Œäº‹åŠ¡å›æ»š", e);
        throw new BusinessException("å®¡æ‰¹æ“ä½œå¤±è´¥: " + e.getMessage());
    }
}
```

#### çŸ­ä¿¡é‡è¯•æœºåˆ¶

```java
@Retryable(
    value = {SmsException.class},
    maxAttempts = 3,
    backoff = @Backoff(delay = 2000)
)
public void sendSmsWithRetry(String phone, String message) {
    smsService.send(phone, message);
}
```

### 3.2 API æ–‡æ¡£è§„èŒƒ

#### Swagger æ³¨è§£ç¤ºä¾‹

```java
@Operation(
    summary = "æäº¤å•†å®¶å…¥é©»ç”³è¯·",
    description = "å•†å®¶å¡«å†™å®Œæ•´ä¿¡æ¯åæäº¤å…¥é©»ç”³è¯·ï¼Œç³»ç»Ÿå°†åœ¨1ä¸ªå·¥ä½œæ—¥å†…å®Œæˆå®¡æ ¸"
)
@ApiResponses({
    @ApiResponse(responseCode = "200", description = "ç”³è¯·æäº¤æˆåŠŸ"),
    @ApiResponse(responseCode = "400", description = "å‚æ•°éªŒè¯å¤±è´¥"),
    @ApiResponse(responseCode = "409", description = "è´¦å·å·²å­˜åœ¨")
})
@PostMapping("/apply")
public R<ApplicationResult> submitApplication(
    @RequestBody @Valid MerchantApplicationRequest request
) {
    // ...
}
```

---

## ğŸ“ å¼€å‘æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶ï¼ˆ12 ä¸ªï¼‰

#### Merchant Service

1. `backend/merchant-service/src/main/java/com/mall/merchant/domain/entity/MerchantApplication.java`
2. `backend/merchant-service/src/main/java/com/mall/merchant/domain/dto/MerchantApplicationRequest.java`
3. `backend/merchant-service/src/main/java/com/mall/merchant/domain/vo/MerchantApplicationVO.java`
4. `backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantApplicationController.java`
5. `backend/merchant-service/src/main/java/com/mall/merchant/service/MerchantApplicationService.java`
6. `backend/merchant-service/src/main/java/com/mall/merchant/service/impl/MerchantApplicationServiceImpl.java`
7. `backend/merchant-service/src/main/java/com/mall/merchant/repository/MerchantApplicationRepository.java`

#### Admin Service

8. `backend/admin-service/src/main/java/com/mall/admin/controller/MerchantApprovalController.java`
9. `backend/admin-service/src/main/java/com/mall/admin/service/MerchantApprovalService.java`
10. `backend/admin-service/src/main/java/com/mall/admin/service/impl/MerchantApprovalServiceImpl.java`

#### æ•°æ®åº“

11. `backend/merchant-service/src/main/resources/db/migration/002_create_application_tables.sql`
12. `backend/merchant-service/src/main/resources/db/migration/003_create_approval_log_table.sql`

### å‰ç«¯æ–‡ä»¶ï¼ˆ5 ä¸ªï¼‰

1. `frontend/src/views/admin/merchants/applications.vue` - ç”³è¯·åˆ—è¡¨é¡µé¢
2. `frontend/src/views/admin/merchants/components/ApplicationDetail.vue` - ç”³è¯·è¯¦æƒ…
3. `frontend/src/views/admin/merchants/components/ApprovalDialog.vue` - å®¡æ‰¹å¯¹è¯æ¡†
4. `frontend/src/api/merchant.js` - å•†å®¶ API å°è£…
5. `frontend/src/api/admin/merchant-approval.js` - å®¡æ‰¹ API å°è£…

### æ–‡æ¡£æ–‡ä»¶ï¼ˆ3 ä¸ªï¼‰

1. `docs/APIæ–‡æ¡£-å•†å®¶å…¥é©»å®¡æ‰¹.md` - å®Œæ•´ API æ¥å£æ–‡æ¡£
2. `docs/ç®¡ç†å‘˜æ“ä½œæ‰‹å†Œ-å•†å®¶å®¡æ‰¹.md` - æ“ä½œæŒ‡å—
3. `docs/æŠ€æœ¯å®ç°æ–¹æ¡ˆ-å•†å®¶å…¥é©».md` - æŠ€æœ¯ç»†èŠ‚è¯´æ˜

---

## ğŸš€ å®æ–½æ­¥éª¤

### Step 1: æ•°æ®åº“å‡†å¤‡ï¼ˆ5 åˆ†é’Ÿï¼‰

- [x] åˆ›å»º merchant_applications è¡¨
- [x] åˆ›å»º merchant_approval_logs è¡¨
- [x] éªŒè¯è¡¨ç»“æ„

### Step 2: åç«¯ API å¼€å‘ï¼ˆ30 åˆ†é’Ÿï¼‰

- [ ] åˆ›å»ºå®ä½“ç±»å’Œ DTO
- [ ] å®ç°ç”³è¯·æäº¤æ¥å£
- [ ] å®ç°ç”³è¯·åˆ—è¡¨æŸ¥è¯¢
- [ ] å®ç°å®¡æ‰¹æ“ä½œæ¥å£
- [ ] é›†æˆ SMS é€šçŸ¥
- [ ] å•å…ƒæµ‹è¯•

### Step 3: å‰ç«¯é¡µé¢å¼€å‘ï¼ˆ20 åˆ†é’Ÿï¼‰

- [ ] å®Œå–„ç”³è¯·æäº¤é¡µé¢ï¼ˆå·²æœ‰åŸºç¡€ï¼‰
- [ ] å¼€å‘ç®¡ç†å‘˜å®¡æ‰¹åˆ—è¡¨é¡µ
- [ ] å¼€å‘å®¡æ‰¹è¯¦æƒ…ç»„ä»¶
- [ ] å¼€å‘å®¡æ‰¹æ“ä½œå¯¹è¯æ¡†
- [ ] é›†æˆ API è°ƒç”¨

### Step 4: æµ‹è¯•ä¸æ–‡æ¡£ï¼ˆ15 åˆ†é’Ÿï¼‰

- [ ] å®Œæ•´æµç¨‹æµ‹è¯•
- [ ] ç”Ÿæˆ API æ–‡æ¡£
- [ ] ç¼–å†™æ“ä½œæ‰‹å†Œ
- [ ] æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

---

## ğŸ“Š é¢„æœŸæˆæœ

### åŠŸèƒ½æˆæœ

1. âœ… å•†å®¶å¯åœ¨çº¿æäº¤å…¥é©»ç”³è¯·ï¼ˆå«è¯ä»¶ä¸Šä¼ ï¼‰
2. âœ… ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰ç”³è¯·ï¼ˆæ”¯æŒç­›é€‰ã€æœç´¢ï¼‰
3. âœ… ç®¡ç†å‘˜å¯å®¡æ‰¹ç”³è¯·ï¼ˆé€šè¿‡/æ‹’ç»+åŸå› ï¼‰
4. âœ… å®¡æ‰¹åè‡ªåŠ¨å‘é€çŸ­ä¿¡é€šçŸ¥
5. âœ… å®¡æ‰¹é€šè¿‡è‡ªåŠ¨åˆ›å»ºå•†å®¶è´¦å·
6. âœ… å®Œæ•´çš„å®¡æ‰¹å†å²è®°å½•
7. âœ… æƒé™è‡ªåŠ¨é…ç½®

### æŠ€æœ¯æˆæœ

1. âœ… å®Œæ•´çš„ RESTful API
2. âœ… äº‹åŠ¡ä¿è¯æ•°æ®ä¸€è‡´æ€§
3. âœ… å¼‚å¸¸å¤„ç†ä¸æ—¥å¿—è¿½è¸ª
4. âœ… Swagger API æ–‡æ¡£
5. âœ… ç®¡ç†å‘˜æ“ä½œæ‰‹å†Œ
6. âœ… æŠ€æœ¯å®ç°æ–‡æ¡£

---

## ğŸ” å®‰å…¨è€ƒè™‘

### æ•°æ®å®‰å…¨

- ç”³è¯·æäº¤éœ€è¦éªŒè¯ç ï¼ˆé˜²æ­¢æ¶æ„æäº¤ï¼‰
- å¯†ç ä½¿ç”¨ BCrypt åŠ å¯†å­˜å‚¨
- æ•æ„Ÿä¿¡æ¯è„±æ•æ˜¾ç¤ºï¼ˆæ‰‹æœºå·ã€èº«ä»½è¯å·ï¼‰
- è¯ä»¶å›¾ç‰‡ MinIO ç§æœ‰è®¿é—®ï¼ˆå¯é€‰ï¼‰

### æ“ä½œå®‰å…¨

- å®¡æ‰¹æ“ä½œéœ€è¦ç®¡ç†å‘˜ç™»å½•è®¤è¯
- è®°å½•å®Œæ•´çš„æ“ä½œæ—¥å¿—ï¼ˆIPã€æ—¶é—´ã€æ“ä½œäººï¼‰
- é˜²æ­¢é‡å¤å®¡æ‰¹ï¼ˆçŠ¶æ€æ£€æŸ¥ï¼‰
- å®¡æ‰¹æ“ä½œæƒé™æ§åˆ¶

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

- å…³é”®å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆapproval_status, created_timeï¼‰
- åˆ†é¡µæŸ¥è¯¢é¿å…å…¨è¡¨æ‰«æ
- ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥

### æ¥å£ä¼˜åŒ–

- åˆ—è¡¨æŸ¥è¯¢ä½¿ç”¨åˆ†é¡µ
- å›¾ç‰‡ URL å¼‚æ­¥åŠ è½½
- çŸ­ä¿¡å‘é€å¼‚æ­¥å¤„ç†
- å®¡æ‰¹æ—¥å¿—å¼‚æ­¥è®°å½•

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### 1. ç”³è¯·æäº¤æµ‹è¯•

```bash
# ä¼ä¸šç”³è¯·
curl -X POST http://localhost:8080/api/merchants/apply \
  -H "Content-Type: application/json" \
  -d '{
    "entityType": "enterprise",
    "shopType": "flagship",
    "shopName": "æµ‹è¯•æ——èˆ°åº—",
    "contactPhone": "13800138000",
    ...
  }'
```

### 2. å®¡æ‰¹æ“ä½œæµ‹è¯•

```bash
# é€šè¿‡ç”³è¯·
curl -X PUT http://localhost:8080/api/admin/merchants/applications/1/approve \
  -H "Authorization: Bearer {adminToken}" \
  -H "Content-Type: application/json" \
  -d '{"approved": true, "reason": "ç¬¦åˆè¦æ±‚"}'
```

---

## ğŸ“… å¼€å‘æ—¶é—´çº¿

| é˜¶æ®µ    | ä»»åŠ¡          | é¢„è®¡æ—¶é—´ | çŠ¶æ€      |
| ------- | ------------- | -------- | --------- |
| Phase 1 | æ•°æ®åº“è®¾è®¡    | 5 åˆ†é’Ÿ   | â³ å¾…å¼€å§‹ |
| Phase 1 | åç«¯ API å¼€å‘ | 30 åˆ†é’Ÿ  | â³ å¾…å¼€å§‹ |
| Phase 1 | å‰ç«¯é¡µé¢å¼€å‘  | 20 åˆ†é’Ÿ  | â³ å¾…å¼€å§‹ |
| Phase 2 | SMS é€šçŸ¥é›†æˆ  | 10 åˆ†é’Ÿ  | â³ å¾…å¼€å§‹ |
| Phase 2 | æƒé™ç®¡ç†      | 15 åˆ†é’Ÿ  | â³ å¾…å¼€å§‹ |
| Phase 3 | æµ‹è¯•ä¸æ–‡æ¡£    | 15 åˆ†é’Ÿ  | â³ å¾…å¼€å§‹ |

**æ€»è®¡**: çº¦ 95 åˆ†é’Ÿï¼ˆ1.5 å°æ—¶ï¼‰

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] å•†å®¶å¯æˆåŠŸæäº¤ç”³è¯·
- [ ] ç”³è¯·ä¿¡æ¯æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
- [ ] ç®¡ç†å‘˜å¯æŸ¥çœ‹ç”³è¯·åˆ—è¡¨
- [ ] å®¡æ‰¹æ“ä½œæ­£å¸¸å·¥ä½œ
- [ ] çŸ­ä¿¡é€šçŸ¥æ­£å¸¸å‘é€
- [ ] å®¡æ‰¹é€šè¿‡åå•†å®¶å¯ç™»å½•
- [ ] å®¡æ‰¹æ—¥å¿—å®Œæ•´è®°å½•

### æŠ€æœ¯éªŒæ”¶

- [ ] API æ¥å£ç¬¦åˆ RESTful è§„èŒƒ
- [ ] ä»£ç é€šè¿‡ç¼–è¯‘æ— é”™è¯¯
- [ ] æ‰€æœ‰äº‹åŠ¡æ­£ç¡®é…ç½®
- [ ] å¼‚å¸¸å¤„ç†å®Œæ•´
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] API æ–‡æ¡£ç”Ÿæˆæ­£ç¡®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£

- [SMS æœåŠ¡æ–‡æ¡£](../backend/sms-service/README.md)
- [MinIO é…ç½®æ–‡æ¡£](../backend/user-service/README.md#MinIOé…ç½®)
- [æƒé™ç®¡ç†è®¾è®¡](./æƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡.md)

### æ•°æ®åº“ä½ç½®

- **å•†å®¶æ•°æ®**: `mall_merchant` æ•°æ®åº“
- **ç®¡ç†å‘˜æ•°æ®**: `mall_admin` æ•°æ®åº“
- **ç”¨æˆ·æ•°æ®**: `mall_user` æ•°æ®åº“

### æœåŠ¡ç«¯å£

- **Merchant Service**: 8087
- **Admin Service**: 8086
- **SMS Service**: 8089
- **MinIO**: 9000

---

_æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2025-11-11_  
_æœ€åæ›´æ–°: 2025-11-11_  
_ç‰ˆæœ¬: 1.0_
