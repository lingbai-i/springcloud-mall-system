# å•†å®¶å…¥é©»ç”³è¯·åŠŸèƒ½ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°

å•†å®¶æäº¤å…¥é©»ç”³è¯·ä¿¡æ¯åï¼Œç®¡ç†åå°ï¼ˆ`http://localhost:5173/admin/merchants/audit`ï¼‰æ²¡æœ‰æ”¶åˆ°ç›¸åº”çš„å®¡æ ¸ä¿¡æ¯ã€‚

## é—®é¢˜åŸå› 

1. **`MerchantApplicationController` æœªå®ç°æ•°æ®åº“ä¿å­˜é€»è¾‘**
   - æ§åˆ¶å™¨ä¸­æœ‰ `TODO` æ³¨é‡Šï¼Œåªè¿”å›ä¸´æ—¶å“åº”
   - ç”³è¯·æ•°æ®æœªä¿å­˜åˆ°æ•°æ®åº“

2. **ç¼ºå°‘å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å®ç°**
   - ç¼ºå°‘ `MerchantApplication` å®ä½“ç±»
   - ç¼ºå°‘ `MerchantApplicationRepository`
   - `MerchantApplicationServiceImpl` åªæœ‰ç©ºå®ç°

## ä¿®å¤å†…å®¹

### 1. åˆ›å»ºå®ä½“ç±»
**æ–‡ä»¶**: `backend/merchant-service/src/main/java/com/mall/merchant/domain/entity/MerchantApplication.java`

- å®Œæ•´æ˜ å°„ `merchant_applications` è¡¨ç»“æ„
- åŒ…å«æ‰€æœ‰å­—æ®µï¼šåº—é“ºä¿¡æ¯ã€è”ç³»äººä¿¡æ¯ã€è¯ä»¶ä¿¡æ¯ã€å®¡æ‰¹çŠ¶æ€ç­‰
- ä½¿ç”¨ JPA æ³¨è§£è¿›è¡Œ ORM æ˜ å°„

### 2. åˆ›å»º Repository
**æ–‡ä»¶**: `backend/merchant-service/src/main/java/com/mall/merchant/repository/MerchantApplicationRepository.java`

å®ç°çš„æŸ¥è¯¢æ–¹æ³•ï¼š
- `findByUsername()` - æ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾
- `existsByUsername()` - æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å­˜åœ¨
- `existsByContactPhone()` - æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å­˜åœ¨
- `existsByShopName()` - æ£€æŸ¥åº—é“ºåç§°æ˜¯å¦å­˜åœ¨
- `findByApprovalStatus()` - æ ¹æ®å®¡æ‰¹çŠ¶æ€æŸ¥è¯¢
- `findByStatusAndKeyword()` - æ ¹æ®çŠ¶æ€å’Œå…³é”®è¯æŸ¥è¯¢ï¼ˆæ”¯æŒæ¨¡ç³Šæœç´¢ï¼‰

### 3. å®Œå–„ Service æ¥å£
**æ–‡ä»¶**: `backend/merchant-service/src/main/java/com/mall/merchant/service/MerchantApplicationService.java`

æ–°å¢æ–¹æ³•ï¼š
- `submitApplication()` - æäº¤ç”³è¯·
- `getApplicationDetail()` - æŸ¥è¯¢ç”³è¯·è¯¦æƒ…
- `auditApplication()` - å®¡æ ¸ç”³è¯·

### 4. å®ç° Service ä¸šåŠ¡é€»è¾‘
**æ–‡ä»¶**: `backend/merchant-service/src/main/java/com/mall/merchant/service/impl/MerchantApplicationServiceImpl.java`

å®ç°åŠŸèƒ½ï¼š
- **æäº¤ç”³è¯·**ï¼š
  - éªŒè¯ç”¨æˆ·åã€æ‰‹æœºå·ã€åº—é“ºåç§°å”¯ä¸€æ€§
  - åŠ å¯†å¯†ç 
  - ä¿å­˜ç”³è¯·åˆ°æ•°æ®åº“
  
- **æŸ¥è¯¢ç”³è¯·åˆ—è¡¨**ï¼š
  - æ”¯æŒåˆ†é¡µ
  - æ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰
  - æ”¯æŒå…³é”®è¯æœç´¢ï¼ˆåº—é“ºåã€è”ç³»äººã€æ‰‹æœºå·ï¼‰
  
- **å®¡æ ¸ç”³è¯·**ï¼š
  - æ›´æ–°å®¡æ‰¹çŠ¶æ€å’Œå®¡æ‰¹ä¿¡æ¯
  - å®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ›å»ºå•†å®¶è´¦å·
  - å…³è”å•†å®¶IDåˆ°ç”³è¯·è®°å½•

### 5. æ›´æ–° Controller
**æ–‡ä»¶**: `backend/merchant-service/src/main/java/com/mall/merchant/controller/MerchantApplicationController.java`

å®ç°çš„æ¥å£ï¼š
- `POST /merchants/apply` - æäº¤ç”³è¯·ï¼ˆå·²ä¿®å¤ï¼Œè°ƒç”¨çœŸå®Serviceï¼‰
- `GET /merchants/applications/{id}` - æŸ¥è¯¢ç”³è¯·è¯¦æƒ…
- `GET /merchants/applications` - æŸ¥è¯¢ç”³è¯·åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
- `PUT /merchants/applications/{id}/audit` - å®¡æ ¸ç”³è¯·

## æ•°æ®æµç¨‹

### å•†å®¶æäº¤ç”³è¯·
```
å‰ç«¯è¡¨å• 
  â†’ POST /api/merchant/apply
  â†’ Gateway (lb://merchant-service)
  â†’ MerchantApplicationController.submitApplication()
  â†’ MerchantApplicationService.submitApplication()
  â†’ éªŒè¯å”¯ä¸€æ€§
  â†’ åŠ å¯†å¯†ç 
  â†’ ä¿å­˜åˆ° merchant_applications è¡¨
  â†’ è¿”å› applicationId
```

### ç®¡ç†å‘˜æŸ¥çœ‹ç”³è¯·åˆ—è¡¨
```
ç®¡ç†åå°
  â†’ GET /api/admin/merchants/audit
  â†’ Gateway (lb://admin-service)
  â†’ Admin-Service (é€šè¿‡ Feign)
  â†’ GET /merchants/applications?status=0
  â†’ MerchantApplicationController.getApplicationList()
  â†’ ä»æ•°æ®åº“æŸ¥è¯¢å¾…å®¡æ‰¹ç”³è¯·
  â†’ è¿”å›åˆ†é¡µæ•°æ®
```

### ç®¡ç†å‘˜å®¡æ ¸ç”³è¯·
```
ç®¡ç†åå°
  â†’ PUT /api/admin/merchants/{id}/audit
  â†’ Admin-Service (é€šè¿‡ Feign)
  â†’ PUT /merchants/applications/{id}/audit
  â†’ MerchantApplicationService.auditApplication()
  â†’ æ›´æ–°å®¡æ‰¹çŠ¶æ€
  â†’ å¦‚æœé€šè¿‡ï¼šåˆ›å»ºå•†å®¶è´¦å·
  â†’ è¿”å›å®¡æ ¸ç»“æœ
```

## æµ‹è¯•éªŒè¯

### 1. æäº¤ç”³è¯·
```bash
curl -X POST http://localhost:8080/api/merchant/apply \
  -H "Content-Type: application/json" \
  -d '{
    "entityType": "enterprise",
    "shopName": "æµ‹è¯•åº—é“º",
    "contactName": "å¼ ä¸‰",
    "contactPhone": "13800138000",
    "email": "test@example.com",
    "companyName": "æµ‹è¯•å…¬å¸",
    "creditCode": "91110000000000000X",
    "legalPerson": "å¼ ä¸‰",
    "businessLicense": "http://example.com/license.jpg",
    "username": "testshop",
    "password": "123456"
  }'
```

### 2. æŸ¥è¯¢ç”³è¯·åˆ—è¡¨
```bash
curl "http://localhost:8080/api/merchant/applications?page=1&size=10&status=0"
```

### 3. å®¡æ ¸ç”³è¯·
```bash
curl -X PUT "http://localhost:8080/api/merchant/applications/1/audit?approved=true&reason=å®¡æ ¸é€šè¿‡&adminId=1&adminName=ç®¡ç†å‘˜"
```

## æœåŠ¡çŠ¶æ€

âœ… **æ‰€æœ‰æœåŠ¡å·²é‡å¯å¹¶æ­£å¸¸è¿è¡Œ**

- merchant-service: ç«¯å£ 8087 âœ…
- å·²æ³¨å†Œåˆ° Nacos (simple å‘½åç©ºé—´) âœ…
- æ‰€æœ‰ 10 ä¸ªå¾®æœåŠ¡æ­£å¸¸è¿è¡Œ âœ…

## æ³¨æ„äº‹é¡¹

1. **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨ `PasswordEncoder` åŠ å¯†å­˜å‚¨
2. **å”¯ä¸€æ€§éªŒè¯**ï¼šç”¨æˆ·åã€æ‰‹æœºå·ã€åº—é“ºåç§°å¿…é¡»å”¯ä¸€
3. **å®¡æ‰¹çŠ¶æ€**ï¼š
   - 0 = å¾…å®¡æ‰¹
   - 1 = å·²é€šè¿‡
   - 2 = å·²æ‹’ç»
4. **è‡ªåŠ¨åˆ›å»ºå•†å®¶è´¦å·**ï¼šå®¡æ ¸é€šè¿‡åè‡ªåŠ¨åˆ›å»º `merchant` è¡¨è®°å½•

## ä¸‹ä¸€æ­¥å»ºè®®

1. âœ… å‰ç«¯æµ‹è¯•å•†å®¶å…¥é©»æµç¨‹
2. âœ… ç®¡ç†åå°æµ‹è¯•å®¡æ ¸åŠŸèƒ½
3. ğŸ”„ æ·»åŠ çŸ­ä¿¡é€šçŸ¥åŠŸèƒ½ï¼ˆå®¡æ ¸ç»“æœé€šçŸ¥ï¼‰
4. ğŸ”„ æ·»åŠ å®¡æ‰¹æ—¥å¿—è®°å½•
5. ğŸ”„ æ·»åŠ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆè¯ä»¶ç…§ç‰‡ï¼‰

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-12  
**ä¿®å¤äºº**: AI Assistant  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•











